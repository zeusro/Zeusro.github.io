## Обычные сборщики мусора

### Сборщик ParNew

-XX:ParallelGCThreads
Ограничивает количество потоков сборки мусора
 
### Сборщик Parallel Scavenge
 
Максимальное время паузы сборки мусора
-XX:MaxGCPauseMillis
Размер пропускной способности
-XX:GCTimeRatio
 
Снижение максимального времени паузы сборки мусора происходит за счёт пропускной способности и пространства нового поколения, напрямую приводя к более частой сборке мусора
 
Операция для новичков:
-XX:UseAdaptiveSizePolicy
Стратегия адаптивной регулировки GC
 
### Сборщик CMS

 Сборщик, нацеленный на получение кратчайшего времени паузы восстановления, реализованный на основе "маркировка-очистка".
Основное преимущество: параллельная сборка, низкая пауза
 

* Случай мониторинга Alibaba Cloud

```
/acs/user/monitoragent/jre/bin/java -server 
-Xmx128m 
-Xms128m 
-Xmn70m 
-XX:SurvivorRatio=10 
-XX:PermSize=25m 
-XX:MaxPermSize=30m 
-XX:+DisableExplicitGC 
-XX:+UseConcMarkSweepGC 
-XX:+CMSParallelRemarkEnabled 
-XX:+UseCMSCompactAtFullCollection 
-XX:+CMSClassUnloadingEnabled 
-XX:LargePageSizeInBytes=128m 
-XX:+UseFastAccessorMethods 
-XX:+UseCMSInitiatingOccupancyOnly 
-XX:CMSInitiatingOccupancyFraction=70 
-XX:+UseParNewGC 
-verbose:gc 
-Xloggc:/acs/monitor/system/monitoragent/logs/gc.log 
-XX:+PrintGCDetails 
-XX:+PrintGCDateStamps 
-Duser.timezone=GMT+8 
-Djava.endorsed.dirs= 
-classpath /acs/user/monitoragent/lib:/acs/user/monitoragent/lib/aliyun-openservices-sls-v0.3-inner-0.1.0.jar:/acs/user/monitoragent/lib/aliyun-openservices-with-mqs.1.0.12.jar:/acs/user/monitoragent/lib/commons-beanutils-1.8.3.jar:/acs/user/monitoragent/lib/commons-codec-1.4.jar:/acs/user/monitoragent/lib/commons-collections-3.2.1.jar:/acs/user/monitoragent/lib/commons-digester-1.8.jar:/acs/user/monitoragent/lib/commons-httpclient-3.1.jar:/acs/user/monitoragent/lib/commons-lang-2.6.jar:/acs/user/monitoragent/lib/commons-lang3-3.1.jar:/acs/user/monitoragent/lib/commons-logging-1.0.4.jar:/acs/user/monitoragent/lib/commons-validator-1.4.0.jar:/acs/user/monitoragent/lib/diamond-client-3.6.7.jar:/acs/user/monitoragent/lib/diamond-utils-3.1.3.jar:/acs/user/monitoragent/lib/ezmorph-1.0.6.jar:/acs/user/monitoragent/lib/fastjson-1.2.41.jar:/acs/user/monitoragent/lib/hamcrest-core-1.1.jar:/acs/user/monitoragent/lib/httpclient-4.2.1.jar:/acs/user/monitoragent/lib/httpcore-4.2.1.jar:/acs/user/monitoragent/lib/jackson-core-lgpl-1.9.6.jar:/acs/user/monitoragent/lib/jackson-mapper-lgpl-1.9.6.jar:/acs/user/monitoragent/lib/jdom-1.1.jar:/acs/user/monitoragent/lib/json-lib-2.4-jdk15.jar:/acs/user/monitoragent/lib/junit-4.10.jar:/acs/user/monitoragent/lib/log4j-1.2.17.jar:/acs/user/monitoragent/lib/mysql-connector-java-5.1.25.jar:/acs/user/monitoragent/lib/netty-all-4.0.36.Final.jar:/acs/user/monitoragent/lib/nginx.agent.jar:/acs/user/monitoragent/lib/ons-api-1.1.5.jar:/acs/user/monitoragent/lib/ons-client-1.1.5.jar:/acs/user/monitoragent/lib/protobuf-java-2.4.1.jar:/acs/user/monitoragent/lib/rocketmq-client-3.6.4.jar:/acs/user/monitoragent/lib/rocketmq-common-3.6.4.jar:/acs/user/monitoragent/lib/rocketmq-remoting-3.6.4.jar:/acs/user/monitoragent/lib/slf4j-api-1.7.5.jar:/acs/user/monitoragent/lib/slf4j-log4j12-1.7.5.jar:/acs/user/monitoragent/lib/test.junit-4.8.1.jar:/acs/user/monitoragent/lib/test.junit.hamcrest-1.1.jar: -Dagent.home=/acs/user/monitoragent com.alibaba.ace.nginx.agent.Startup /acs/user/monitoragent/conf
``` 

### Сборщик G1

https://t.hao0.me/jvm/2017/01/15/jvm-g1.html

### ConcMarkSweepGC

Рекомендуемый параметр — -Xmn, потому что этот параметр очень лаконичен, эквивалентен одноразовой установке NewSize и MaxNewSize, и оба равны. -Xmn в сочетании с -Xms начальным размером кучи и -Xmx максимальным размером кучи точно определяет расположение памяти кучи (дизайнер, вероятно, также создал три сокращённых параметра для простоты). Кроме того, официальные документы, кажется, говорят, что -Xmn начал поддерживаться в 1.4, но в наши дни не должно быть никого, кто всё ещё использует JRE до 1.4, верно? 
 
* Пример использования

```bash
java -jar 
-Xms10g 
-Xmx15g 
-XX:+UseConcMarkSweepGC 
-XX:NewSize=6g 
-XX:MaxNewSize=6g 
-verbose:gc 
-XX:+PrintGCDetails 
-XX:+PrintGCTimeStamps  
-Xloggc:./log/gc.log Slaver.jar
```

## Инструменты анализа JVM

### jstat
> Преимущество jstat в том, что он встроен в JVM, прост и прямолинеен в использовании


    jstat -<option> [-t] [-h<lines>] <vmid> [<interval> [<count>]]
    pid=1
    jstat -gc $pid 3000 3000

```
–class Мониторинг загрузки, выгрузки классов, общего пространства и времени, затраченного на загрузку классов
–gc Мониторинг состояния кучи Java, включая область Eden, 2 области Survivor, старое поколение, постоянное поколение и т.д.
–gccapacity Содержимое мониторинга в основном такое же, как -gc, но вывод в основном фокусируется на максимальном и минимальном пространстве, используемом в каждой области кучи Java
–gcutil Содержимое мониторинга в основном такое же, как -gc, но вывод в основном фокусируется на проценте используемого пространства к общему пространству
–gccause Та же функция, что и -gcutil, но будет дополнительно выводить причину последнего GC
–gcnew Мониторинг статуса GC нового поколения
–gcnewcapacity Содержимое мониторинга в основном такое же, как -gcnew, вывод в основном фокусируется на максимальном и минимальном используемом пространстве
–gcold Мониторинг статуса GC старого поколения
–gcoldcapacity Содержимое мониторинга в основном такое же, как ——gcold, вывод в основном фокусируется на максимальном и минимальном используемом пространстве
–gcpermcapacity Вывод максимального и минимального пространства, используемого в постоянном поколении
–compiler Вывод методов, скомпилированных JIT-компилятором, затраченного времени и т.д.
–printcompilation Вывод методов, которые были скомпилированы JIT
```

1. jstat –class<pid> : Отображение количества загруженных классов, занимаемого пространства и т.д.
```
Loaded Количество загруженных классов
Bytes Байты, занимаемые загруженными классами
Unloaded Количество выгруженных классов
Bytes Байты выгруженных классов
Time Время, затраченное на загрузку и выгрузку классов
```

2. jstat -compiler <pid> Отображение количества компиляций VM в реальном времени и т.д.
```
Compiled Количество выполненных задач компиляции
Failed Количество неудачных выполнений задач компиляции
Invalid Количество недействительных выполнений задач компиляции
Time Время, затраченное на задачи компиляции
FailedType Тип последней неудачной задачи компиляции
FailedMethod Класс и метод, где находится последняя неудачная задача компиляции
```

3. jstat -gc <pid>: Может отображать информацию о GC, просматривать количество и время GC.
```
S0C Ёмкость первого выжившего (область выживания) в молодом поколении (байты)
S1C Ёмкость второго выжившего (область выживания) в молодом поколении (байты)
S0U В настоящее время используемое пространство первого выжившего (область выживания) в молодом поколении (байты)
S1U В настоящее время используемое пространство второго выжившего (область выживания) в молодом поколении (байты)
EC Ёмкость Eden (Эдемский сад) в молодом поколении (байты)
EU В настоящее время используемое пространство Eden (Эдемский сад) в молодом поколении (байты)
OC Ёмкость старого поколения (байты)
OU В настоящее время используемое пространство старого поколения (байты)
PC Ёмкость Perm (постоянное поколение) (байты)
PU В настоящее время используемое пространство Perm (постоянное поколение) (байты)
YGC Количество GC в молодом поколении от запуска приложения до выборки
YGCT Время, затраченное на GC в молодом поколении от запуска приложения до выборки (с)
FGC Количество GC в старом поколении (полный GC) от запуска приложения до выборки
FGCT Время, затраченное на GC в старом поколении (полный GC) от запуска приложения до выборки (с)
GCT Общее время, затраченное на GC от запуска приложения до выборки (с)
```

4. jstat -gccapacity <pid>: Может отображать использование и занимаемый размер объектов трёх поколений (young, old, perm) в памяти VM
```
NGCMN Инициализированный (минимальный) размер в молодом поколении (young) (байты)
NGCMX Максимальная ёмкость молодого поколения (young) (байты)
NGC Текущая ёмкость молодого поколения (young) (байты)
S0C Ёмкость первого выжившего (область выживания) в молодом поколении (байты)
S1C Ёмкость второго выжившего (область выживания) в молодом поколении (байты)
EC Ёмкость Eden (Эдемский сад) в молодом поколении (байты)
OGCMN Инициализированный (минимальный) размер в старом поколении (байты)
OGCMX Максимальная ёмкость старого поколения (байты)
OGC Текущая вновь сгенерированная ёмкость старого поколения (байты)
OC Ёмкость старого поколения (байты)
PGCMN Инициализированный (минимальный) размер в поколении perm (байты)
PGCMX Максимальная ёмкость поколения perm (байты)
PGC Текущая вновь сгенерированная ёмкость поколения perm (байты)
PC Ёмкость Perm (постоянное поколение) (байты)
YGC Количество GC в молодом поколении от запуска приложения до выборки
FGC Количество GC в старом поколении (полный GC) от запуска приложения до выборки
```

5. jstat -gcutil <pid>: Статистика информации о GC
```
S0 Процент используемого пространства первого выжившего (область выживания) в молодом поколении к текущей ёмкости
S1 Процент используемого пространства второго выжившего (область выживания) в молодом поколении к текущей ёмкости
E Процент используемого пространства Eden (Эдемский сад) в молодом поколении к текущей ёмкости
O Процент используемого пространства старого поколения к текущей ёмкости
P Процент используемого пространства поколения perm к текущей ёмкости
YGC Количество GC в молодом поколении от запуска приложения до выборки
YGCT Время, затраченное на GC в молодом поколении от запуска приложения до выборки (с)
FGC Количество GC в старом поколении (полный GC) от запуска приложения до выборки
FGCT Время, затраченное на GC в старом поколении (полный GC) от запуска приложения до выборки (с)
GCT Общее время, затраченное на GC от запуска приложения до выборки (с)
```

6. jstat -gcnew <pid>: Информация об объектах молодого поколения.

```
S0C Ёмкость первого выжившего (область выживания) в молодом поколении (байты)
S1C Ёмкость второго выжившего (область выживания) в молодом поколении (байты)
S0U В настоящее время используемое пространство первого выжившего (область выживания) в молодом поколении (байты)
S1U В настоящее время используемое пространство второго выжившего (область выживания) в молодом поколении (байты)
TT Лимит количества удержаний
MTT Максимальный лимит количества удержаний
EC Ёмкость Eden (Эдемский сад) в молодом поколении (байты)
EU В настоящее время используемое пространство Eden (Эдемский сад) в молодом поколении (байты)
YGC Количество GC в молодом поколении от запуска приложения до выборки
YGCT Время, затраченное на GC в молодом поколении от запуска приложения до выборки (с)
```

7. jstat -gcnewcapacity<pid>: Информация об объектах молодого поколения и их использовании.

```
NGCMN Инициализированный (минимальный) размер в молодом поколении (young) (байты)
NGCMX Максимальная ёмкость молодого поколения (young) (байты)
NGC Текущая ёмкость молодого поколения (young) (байты)
S0CMX Максимальная ёмкость первого выжившего (область выживания) в молодом поколении (байты)
S0C Ёмкость первого выжившего (область выживания) в молодом поколении (байты)
S1CMX Максимальная ёмкость второго выжившего (область выживания) в молодом поколении (байты)
S1C Ёмкость второго выжившего (область выживания) в молодом поколении (байты)
ECMX Максимальная ёмкость Eden (Эдемский сад) в молодом поколении (байты)
EC Ёмкость Eden (Эдемский сад) в молодом поколении (байты)
YGC Количество GC в молодом поколении от запуска приложения до выборки
FGC Количество GC в старом поколении (полный GC) от запуска приложения до выборки
```
8. jstat -gcold <pid>：Информация об объектах старого поколения.
```
PC Ёмкость Perm (постоянное поколение) (байты)
PU В настоящее время используемое пространство Perm (постоянное поколение) (байты)
OC Ёмкость старого поколения (байты)
OU В настоящее время используемое пространство старого поколения (байты)
YGC Количество GC в молодом поколении от запуска приложения до выборки
FGC Количество GC в старом поколении (полный GC) от запуска приложения до выборки
FGCT Время, затраченное на GC в старом поколении (полный GC) от запуска приложения до выборки (с)
GCT Общее время, затраченное на GC от запуска приложения до выборки (с)
```
9. stat -gcoldcapacity <pid>: Информация об объектах старого поколения и их использовании.
```
OGCMN Инициализированный (минимальный) размер в старом поколении (байты)
OGCMX Максимальная ёмкость старого поколения (байты)
OGC Текущая вновь сгенерированная ёмкость старого поколения (байты)
OC Ёмкость старого поколения (байты)
YGC Количество GC в молодом поколении от запуска приложения до выборки
FGC Количество GC в старом поколении (полный GC) от запуска приложения до выборки
FGCT Время, затраченное на GC в старом поколении (полный GC) от запуска приложения до выборки (с)
GCT Общее время, затраченное на GC от запуска приложения до выборки (с)
```
10. jstat -gcpermcapacity<pid>: Информация об объектах perm и их использовании.
```
PGCMN Инициализированный (минимальный) размер в поколении perm (байты)
PGCMX Максимальная ёмкость поколения perm (байты)
PGC Текущая вновь сгенерированная ёмкость поколения perm (байты)
PC Ёмкость Perm (постоянное поколение) (байты)
YGC Количество GC в молодом поколении от запуска приложения до выборки
FGC Количество GC в старом поколении (полный GC) от запуска приложения до выборки
FGCT Время, затраченное на GC в старом поколении (полный GC) от запуска приложения до выборки (с)
GCT Общее время, затраченное на GC от запуска приложения до выборки (с)
```
11. jstat -printcompilation <pid>：Текущая информация о выполнении VM.
```
Compiled Количество задач компиляции
Size Размер байт-кода, сгенерированного методами
Type Тип компиляции
Method Имя класса и имя метода, используемые для идентификации скомпилированных методов. Имена классов используют / в качестве разделителя пространства имён. Имя метода — это метод в данном классе. Вышеуказанный формат устанавливается опцией -XX:+PrintComplation
```

### MemoryAnalyzer

## Ссылки
1. [Настройка JVM: Выбор подходящего сборщика GC (Три)](https://blog.csdn.net/historyasamirror/article/details/6245157)
1. [Глубокое понимание сборщика мусора Java G1](http://ghoulich.xninja.org/tag/g1/)
1. [Стать экспертом JavaGC (1)—Механизм сборки мусора Java, глубокий и простой](http://www.importnew.com/1993.html)
1. [Стать экспертом JavaGC (2)—Как мониторить механизм сборки мусора Java](http://www.importnew.com/2057.html)
1. [Стать экспертом Java GC (3)—Как оптимизировать механизм сборки мусора Java](http://www.importnew.com/3146.html)
1. [Стать экспертом Java GC (4)—Подробное объяснение параметра MaxClients Apache и его влияние на выполнение FullGC в Tomcat](http://www.importnew.com/3151.html)
1. [Серия JVM Три: Настройка и анализ параметров JVM](http://www.cnblogs.com/redcreen/archive/2011/05/04/2037057.html)
1. [Введение в типы Java GC и замена/настройка GC](https://blog.csdn.net/roland101/article/details/2203461)
1. [Механизм сборки мусора Java (и как уменьшить вызовы GC и повысить производительность)](https://blog.csdn.net/hyqsong/article/details/42006947)
1. [What Is Garbage Collection?](https://plumbr.io/handbook/what-is-garbage-collection)
1. [Анализ частого GC (Allocation Failure) и слишком длительного времени young gc](https://juejin.im/post/5a9b811a6fb9a028e46e1c88)
1. [Серия JVM Три: Настройка и анализ параметров JVM](http://www.cnblogs.com/redcreen/archive/2011/05/04/2037057.html)
1. [Настройка javaGC](http://darktea.github.io/notes/2013/09/08/java-gc.html)
1. [Некоторые ключевые технологии Java Hotspot G1 GC](https://tech.meituan.com/g1.html)
1. [JVM](https://crowhawk.github.io/tags/#JVM)
1. [Настройки памяти JVM (java виртуальная машина)](https://www.cnblogs.com/jack204/archive/2012/07/02/2572932.html)
1. [Использование java jstat](https://www.pocketdigi.com/20170522/1573.html)
1. [Подробное объяснение команды jstat](https://blog.csdn.net/zhaozheng7758/article/details/8623549)
1. [Подробное объяснение использования jstat (Анализ использования JVM)](https://blog.csdn.net/ouyang111222/article/details/53688986)
1. [Механизм загрузки классов java](http://www.cnblogs.com/ityouknow/p/5603287.html)
1. [Использование G1(Garbage First)](http://bboniao.com/jvm/2014-03/g1garbage-first.html)
1. [Серия обучения командам Java (4): Jstat](http://www.importnew.com/18202.html)
1. [Руководство по анализу и обработке проблем JVM](https://yq.aliyun.com/articles/632125)
1. [Резюме настройки JVM -Xms -Xmx -Xmn -Xss](https://yq.aliyun.com/articles/268842)

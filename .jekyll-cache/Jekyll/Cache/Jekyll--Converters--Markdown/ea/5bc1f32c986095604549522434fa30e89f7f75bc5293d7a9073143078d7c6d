I"ÆM<h2 id="å‰è¨€">å‰è¨€</h2>

<p>æˆ‘ä»¬è¦åšçš„äº‹æƒ…å¾ˆç®€å•,ç”¨Concourseè¿™ä¸ªå·¥å…·æ‹‰å–ç§æœ‰ä»£ç åº“çš„Javaæºä»£ç ,æ„å»ºç„¶åæ¨é€åˆ°é˜¿é‡Œäº‘ä»“åº“.</p>

<p>æˆ‘å¸Œæœ›çœ‹è¿™ç¯‡æ–‡ç« çš„äººèƒ½å¤Ÿé‡ç‚¹çœ‹å‰é¢å‡ æ®µå†…å®¹,è€Œä¸æ˜¯å­¦ä¼šäº†çš®æ¯›,ä½†æ²¡åŠæ³•ç†è§£è¿™ä¸ªå·¥å…·çš„è®¾è®¡ç†å¿µ.</p>

<h2 id="æ¦‚å¿µä»‹ç»">æ¦‚å¿µä»‹ç»</h2>
<blockquote>
  <p><strong>Pipelineæ˜¯ä¸€ç­‰å…¬æ°‘ï¼šConcourseä»¥pipelineæœºåˆ¶è¿è¡Œé›†æˆä»»åŠ¡ã€‚pipelineå°†Taskã€Resourceã€Jobä¸‰è€…æœ‰æœºåœ°ç»“åˆèµ·æ¥ã€‚</strong></p>

  <p>ä»»åŠ¡ï¼ˆTaskï¼‰æ˜¯æ‰§è¡Œçš„åŸºæœ¬å•å…ƒï¼Œè¡¨ç°ä¸ºåœ¨ä¸€ä¸ªå…¨æ–°å¯åŠ¨çš„å®¹å™¨ä¸­æ‰€è¿è¡Œçš„è„šæœ¬ã€‚å®¹å™¨å·²ç»ç»è¿‡äº†é¢„å¤„ç†ï¼Œå› æ­¤å…¶ä¸­åŒ…å«äº†ä¸€ä¸ªè¾“å…¥ä¸è¾“å‡ºç›®å½•ï¼Œä»»åŠ¡è„šæœ¬å¯åœ¨è¿™äº›ç›®å½•ä¸­è¿è¡Œã€‚</p>

  <p>èµ„æºï¼ˆResourceï¼‰åˆ™è¡¨ç°ä¸ºç‰ˆæœ¬åŒ–èµ„æºçš„æŠ½è±¡ä½ç½®ï¼Œä¾‹å¦‚æŸä¸ªrepositoryã€‚èµ„æºä¹Ÿå¯ç”¨äºå¯¹è¿›å…¥æˆ–é€€å‡ºæŸä¸ªç®¡é“çš„å¤–éƒ¨ä¾èµ–è¿›è¡Œå»ºæ¨¡ï¼Œæˆ–æ˜¯è¡¨ç¤ºæ›´æŠ½è±¡çš„æ¦‚å¿µï¼Œä¾‹å¦‚æ—¶é—´è§¦å‘å™¨ç­‰ç­‰ã€‚èµ„æºçš„å˜æ›´å¯è¢«æ£€æµ‹ï¼ˆæ£€æŸ¥ï¼‰ã€è·å–ï¼ˆè·å¾—ï¼‰ä»¥åŠå‘å¸ƒï¼ˆæ¨é€ï¼‰ã€‚ä¸åŒçš„èµ„æºç±»å‹ï¼ˆä¾‹å¦‚Gitã€AWS S3æˆ–è§¦å‘å™¨ï¼‰å¯ç”¨äºå°è£…ç”¨äºç®¡é“çš„å„ç§æ ·æ¿ä»£ç ï¼Œä¸ºConcourseçš„æ‰©å±•æä¾›äº†ä¸€ä¸ªå¯é€‚é…çš„æ¥å£ã€‚</p>

  <p>ä½œä¸šï¼ˆJobï¼‰æ˜¯ç”±èµ„æºä¸ä»»åŠ¡æ„æˆçš„ï¼Œé€šè¿‡æ„å»ºè®¡åˆ’å®ç°ã€‚ä½œä¸šå¯ç”±èµ„æºçš„å˜æ›´æ‰€è§¦å‘ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æ‰‹åŠ¨è§¦å‘ï¼Œä»¥å®ç°äººå·¥æ‰¹å‡†æµç¨‹ã€‚</p>

  <p><strong>èŠ‚é€‰è‡ª<a href="http://www.infoq.com/cn/news/2016/05/concourse">Concourseï¼šå¯æ‰©å±•çš„å¼€æºCIç®¡é“å·¥å…·</a></strong></p>
</blockquote>

<h2 id="å‰æœŸå¿ƒç†å‡†å¤‡">å‰æœŸå¿ƒç†å‡†å¤‡</h2>

<blockquote>
  <p>Concourse-CI æ˜¯ä¸€ä¸ªå¾ˆå‘çˆ¹çš„å¼€æºé¡¹ç›®.
æ–‡æ¡£å†™çš„ç®€ç›´ç‹—å±,å¦‚æœä¸æ˜¯2ä¸ªèµ„æ·±åŒäº‹å¸®åŠ©,ä¼°è®¡æˆ‘æ—©å·²æ‘”é”…èµ°äºº.</p>

  <p>æˆ‘èŠ±äº†æ•´æ•´3å¤©å­¦ä¹ ä¹‹å,è“¦ç„¶å›é¦–,å‘ç°æœ€å¥½ç”¨çš„å…¶å®è¿˜æ˜¯ <code class="highlighter-rouge">fly -h</code>è¿™ä¸ªå‘½ä»¤.å®ƒè§£é‡Šäº†Concourse-CIèƒ½å¤Ÿåšçš„æ‰€æœ‰äº‹æƒ….</p>

  <p>åˆå­¦è¿™ç©æ„çš„æ—¶å€™,ä¸€å®šè¦å¼„æ¸…æ¦‚å¿µ.</p>

  <p>ä¸€å¼€å§‹çš„æ—¶å€™,ä»–è¿™ä¸ªæ‰€è°“çš„<strong>ç®¡é“</strong>å¯¹æˆ‘æ¥è¯´ç®€ç›´å°±æ˜¯æˆ‘ä»¬å®¶ä¹¡é€¢é›¨å¿…æµ¸çš„ç ´æ°´æ²Ÿ,ç®€ç›´ç‹—å±ä¸é€š.æˆ‘ä»¬ç”¨<code class="highlighter-rouge">Jenkins</code>ä¹Ÿå¥½,ç›´æ¥<code class="highlighter-rouge">æœ¬åœ°æ„å»º</code>ä¹Ÿç½¢,å…¶å®æ˜¯åŸºäº<code class="highlighter-rouge">åŒä¸€ä¸ªä¸Šä¸‹æ–‡</code>.æˆ‘ä»¬åœ¨åŒä¸€ä¸ªç¯å¢ƒä¸‹cdæ¥cdå»,ç„¶ågradle build/mvn installäº‘äº‘.</p>

  <p>ä½†æ˜¯Concourseçš„ä¸Šä¸‹æ–‡ä¸€å¼€å§‹å¯¹æˆ‘æ¥è¯´æ˜¯æå…¶å‰²è£‚çš„.æ¯ä¸€ä¸ªå­ä»»åŠ¡éƒ½æ˜¯åœ¨å„è‡ªä¸åŒçš„é•œåƒä¸Šé¢è·‘.å†åŠ ä¸Šé…ç½®jobçš„æ–‡ä»¶æ˜¯åœ¨æœ¬åœ°,æå¾—å½“æ—¶æˆ‘æ ¹æœ¬åˆ†ä¸æ¸…ç¯å¢ƒå˜é‡åˆ°åº•å“ªä¸ªç¯å¢ƒçš„å˜é‡(æœ¬åœ°ç¯å¢ƒ,Concourseæ‰€åœ¨çš„æœåŠ¡å™¨ç¯å¢ƒ,job/taské‡Œé¢çš„dockerç¯å¢ƒ)â€¦</p>

  <p>ä½†éšç€å­¦ä¹ çš„æ·±å…¥,è¿™ä¸Šé¢çš„ä¸€æ®µè¯å…¶å®æ˜¯ä¸€æ®µè¯¯è§£.<code class="highlighter-rouge">task</code>å¯ä»¥é€šè¿‡<code class="highlighter-rouge">inputs</code>æ¥æ”¶<code class="highlighter-rouge">resources</code>çš„ç»“æœ.<code class="highlighter-rouge">task</code>ä¸<code class="highlighter-rouge">task</code>ä¹‹é—´é€šè¿‡<code class="highlighter-rouge">inputs</code>å’Œ<code class="highlighter-rouge">outputs</code>ä¼ é€’ç»“æœ.</p>

  <p><strong>ç†è§£è¿™ä¸ªä¸Šä¸‹æ–‡,åé¢çš„å·¥ä½œå°±å¥½åŠå¤šäº†.</strong></p>

  <p>è€Œ<code class="highlighter-rouge">fly</code>å‘½ä»¤æ˜¯åŸºäºæœ¬åœ°çš„,é‚£ä¹ˆ<code class="highlighter-rouge">-v</code>çš„å†…å®¹å…¶å®ä¹Ÿæ˜¯åŸºäºæœ¬åœ°ä¸Šä¸‹æ–‡.</p>

  <p>è€Œæˆ‘ä»¬çš„æ„å»ºå·¥ä½œä¹Ÿå˜å¾—ç›¸å½“çš„æ¸…æ™°.</p>
</blockquote>

<h2 id="å‰æœŸå‡†å¤‡">å‰æœŸå‡†å¤‡</h2>

<h3 id="æœ¬åœ°ç¯å¢ƒ">æœ¬åœ°ç¯å¢ƒ</h3>
<ol>
  <li>å®‰è£…<code class="highlighter-rouge">docker</code>,<code class="highlighter-rouge">docker-compose</code>.</li>
  <li>ä¸‹è½½é…ç½®flyå·¥å…·<a href="https://concourse-ci.org/download.html">fly</a></li>
  <li></li>
</ol>

<p>é€šè¿‡å®‰è£…<code class="highlighter-rouge">fly</code>å·¥å…·å®ç°ä¸æœåŠ¡å™¨çš„é€šè®¯</p>

<h3 id="æœåŠ¡å™¨ç¯å¢ƒ-docker-composeyaml">æœåŠ¡å™¨ç¯å¢ƒ docker-compose.yaml</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="rouge-code"><pre>
<span class="na">concourse-db</span><span class="pi">:</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:11-alpine</span>
  <span class="na">hostname</span><span class="pi">:</span> <span class="s">concourse-db</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">/root/docker/concourse/database:/database</span>
  <span class="na">environment</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">POSTGRES_DB=concourse'</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">POSTGRES_PASSWORD=root'</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">POSTGRES_USER=root'</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">PGDATA=/database'</span>

<span class="na">concourse-web</span><span class="pi">:</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">concourse/concourse:4.0.0</span>
  <span class="na">hostname</span><span class="pi">:</span> <span class="s">concourse-web</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">9003:8080'</span>
  <span class="na">command</span><span class="pi">:</span> <span class="s">web</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">/root/docker/concourse/keys/web:/concourse-keys</span>
  <span class="na">environment</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">CONCOURSE_POSTGRES_HOST=concourse-db'</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">CONCOURSE_POSTGRES_DATABASE=concourse'</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">CONCOURSE_POSTGRES_USER=root'</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">CONCOURSE_POSTGRES_PASSWORD=root'</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">CONCOURSE_EXTERNAL_URL=https://ci.zeusro.io'</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">CONCOURSE_MAIN_TEAM_ALLOW_ALL_USERS=true'</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">CONCOURSE_ADD_LOCAL_USER=zeusro:pwd'</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="s">aliyun.depends</span><span class="pi">:</span> <span class="s">concourse-db</span>

<span class="na">concourse-worker</span><span class="pi">:</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">concourse/concourse:4.0.0</span>
  <span class="na">privileged</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">command</span><span class="pi">:</span> <span class="s">worker --work-dir /opt/concourse/worker</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">/root/docker/concourse/keys/worker:/concourse-keys</span>
    <span class="pi">-</span> <span class="s">/root/docker/concourse/worker:/opt/concourse/worker</span>
  <span class="na">environment</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">CONCOURSE_TSA_HOST=concourse-web:2222'</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">CONCOURSE_GARDEN_DNS_SERVER=114.114.114.114'</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="s">aliyun.depends</span><span class="pi">:</span> <span class="s">concourse-web</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ol>
  <li>æ•°æ®å·è¦æŒ‰éœ€æŒ‡å®šç›®å½•</li>
  <li>å¦‚æœä¸æ˜¯åœ¨é˜¿é‡Œäº‘ä¸»æœºä¸Šé¢è·‘,<code class="highlighter-rouge">aliyun.depends</code>æ”¹ä¸º<code class="highlighter-rouge">docker-compose</code>çš„<a href="https://docs.docker.com/compose/compose-file/#depends_on">depends_on</a></li>
  <li>CONCOURSE_EXTERNAL_URLæŒ‰éœ€ç»‘å®šè‡ªå·±çš„åŸŸå</li>
  <li>
    <p>CONCOURSE_ADD_LOCAL_USERæŒ‰éœ€é…ç½®<code class="highlighter-rouge">Concourse-CI</code>çš„ç”¨æˆ·åå’Œå¯†ç </p>

    <p>docker-compose up
 fly -t zeusro login -b -c https://ci.zeusro.io
 è¾“å…¥ç”¨æˆ·å,å¯†ç </p>
  </li>
</ol>

<h3 id="æ„å»ºç”¨javaé•œåƒ">æ„å»ºç”¨Javaé•œåƒ</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>FROM openjdk:8-alpine3.8
LABEL maintainer="zeusro"
# ä¸­å›½ç‰¹è‰²ç¤¾ä¼šä¸»ä¹‰
RUN echo https://mirrors.ustc.edu.cn/alpine/v3.8/main &gt; /etc/apk/repositories; \
echo https://mirrors.ustc.edu.cn/alpine/v3.8/community &gt;&gt; /etc/apk/repositories;\
echo "Asia/Shanghai" &gt; /etc/timezone ;\
apk add --no-cache bash maven gradle 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æˆ‘æŠŠè¿™ä¸ªé•œåƒå‘½åä¸º<code class="highlighter-rouge">registry.cn-shenzhen.aliyuncs.com/amiba/openjdk:8-tools</code></p>

<h2 id="å¯¹æ„å»ºçš„å»ºæ¨¡">å¯¹æ„å»ºçš„å»ºæ¨¡</h2>

<p>æˆ‘ä»¬å…ˆæŠ›å¼€ä¸€äº›,æƒ³ä¸€ä¸ªé—®é¢˜:æˆ‘ç°åœ¨æœ‰ä¸€å°å´­æ–°çš„æœåŠ¡å™¨,æˆ‘è¦æ€ä¹ˆéƒ¨ç½²Javaçš„ä»£ç ?</p>

<p>é—®é¢˜çš„ç­”æ¡ˆåŸºæœ¬å¯ä»¥å½’çº³ä¸ºä»¥ä¸‹çš„æ­¥éª¤.</p>

<ol>
  <li>å®‰è£…<code class="highlighter-rouge">git</code>,<code class="highlighter-rouge">maven</code>/<code class="highlighter-rouge">gradle</code>,<code class="highlighter-rouge">java JDK</code>,<code class="highlighter-rouge">docker</code></li>
  <li>git clone xx</li>
  <li>mvn install ç§æœ‰ä¾èµ–</li>
  <li>æ‰§è¡Œä¸»ä½“é¡¹ç›®çš„æ„å»ºå‘½ä»¤</li>
  <li>å°†ç”Ÿæˆçš„jaråŒ…æ‰“åŒ…åˆ°dockeré•œåƒé‡Œé¢</li>
  <li>docker push</li>
</ol>

<p>é‚£ä¹ˆåˆ‡æ¢åˆ° <code class="highlighter-rouge">Concourse-CI</code> è¿™ä¸ªè¯­å¢ƒ.è¿™ä¸ªæ­¥éª¤å°±å˜æˆäº†</p>

<ol>
  <li>è·å–ç§æœ‰ä¾èµ–,ä¸»ä½“é¡¹ç›®è¿™Nä¸ª<code class="highlighter-rouge">resources</code>(å‡è®¾ç§æœ‰ä¾èµ–å¯èƒ½æœ‰å¤šä¸ª)</li>
  <li>åœ¨ä¸€ä¸ªæœ‰<code class="highlighter-rouge">git</code>,<code class="highlighter-rouge">maven</code>/<code class="highlighter-rouge">gradle</code>,<code class="highlighter-rouge">java JDK</code>çš„ç¯å¢ƒé‡Œé¢æ‰§è¡Œæ„å»ºä»»åŠ¡(task)</li>
  <li>å°†ç”Ÿæˆçš„jaråŒ…æ‰“åŒ…åˆ°dockeré•œåƒé‡Œé¢(task)</li>
  <li>docker push(put <code class="highlighter-rouge">resources</code>)</li>
</ol>

<h2 id="concourse-ciçš„æ„å»ºä¸Šä¸‹æ–‡">Concourse-CIçš„æ„å»ºä¸Šä¸‹æ–‡</h2>

<p>æ¯æ¬¡æ„å»ºä»»åŠ¡å¼€å§‹æ—¶,æˆ‘ä»¬é€šè¿‡<code class="highlighter-rouge">pwd</code>å‘ç°å…¶æ¯ä¸€æ¬¡éƒ½æ˜¯ä¸€ä¸ªæŒ‰ç…§ç‰¹å®šè§„åˆ™å‘½åçš„ä¸´æ—¶ç›®å½•.<code class="highlighter-rouge">inputs</code>,<code class="highlighter-rouge">outputs</code>,<code class="highlighter-rouge">cache</code>éƒ½æ˜¯æŒ‡å®šè¿™ä¸ªä¸´æ—¶ç›®å½•ä¸‹çš„ç›®å½•.</p>

<p>å‡è®¾æŸæ¬¡æ„å»ºçš„ä¸´æ—¶ç›®å½•æ˜¯<code class="highlighter-rouge">/temp/xxx</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre> inputs:
      - name: dependency1
      - name: dev-repo
      outputs:
      - name: dev-resource
      caches:
      - path: dependency-cache-1
</pre></td></tr></tbody></table></code></pre></div></div>

<p>é‚£ä¹ˆè¿™ä¸ªé…ç½®äº§ç”Ÿçš„ç›®å½•(<code class="highlighter-rouge">ls /temp/xxx</code>)å°±æ˜¯</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>dependency1---------|ç§æœ‰ä¾èµ–gitä»“åº“
dev-repo------------|ä¸»é¢˜é¡¹ç›®gitä»“åº“
dev-resource--------|äº¤ä»˜ç»™ä¸‹ä¸€ä¸ªtaskçš„ç›®å½•,ä¸‹ä¸€ä¸ªtaskç”¨inputsæ¥æ”¶
dependency-cache-1--|ç¼“å­˜çš„ç›®å½•
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="cachesæœºåˆ¶">cachesæœºåˆ¶</h2>

<p>é¦–å…ˆé—®ä¸€ä¸ªé—®é¢˜,ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜è¿™ç§æœºåˆ¶?</p>

<p>è¿™ä¸ªé—®é¢˜å¾—ä»ä¾èµ–çš„è¿˜åŸæœºåˆ¶å…¥æ‰‹.ä¾èµ–ä¸€èˆ¬æ˜¯ä»æœ¬åœ°ç¼“å­˜æŠ“å–æ–‡ä»¶,å¦‚æœæœ¬åœ°ç¼“å­˜æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶,åˆ™ä»ä¸­å¿ƒä»“åº“é‡Œé¢æ‹‰å–.ä½†æ˜¯<code class="highlighter-rouge">Concourse-CI</code>è¿™ä¸ªå‘çˆ¹ç©æ„æ˜¯æ²¡æœ‰å…¨å±€ä¸Šä¸‹æ–‡è¿™ç§ä¸œè¥¿çš„,æ¯ä¸€æ¬¡æ„å»ºéƒ½æ˜¯é‡æ–°æ‹‰å–é•œåƒ,é‚£ä¹ˆå¦‚æœä¸èµ°ç¼“å­˜,è¿™ä¸ªä¸‹è½½ä¾èµ–çš„åŠ¨ä½œå°±ä¼šåœ¨æ¯ä¸€æ¬¡çš„æ„å»ºä»»åŠ¡ä¸­é‡å¤è¿›è¡Œ.<code class="highlighter-rouge">caches</code>æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œç”Ÿ.</p>

<h2 id="å¼€å¹²">å¼€å¹²</h2>

<p><a href="https://github.com/zeusro/spring-boot-template-with-Concourse-CI">æˆ‘çš„ç¤ºä¾‹é¡¹ç›®</a></p>

<h3 id="ä¸€å¼€å§‹çš„æ€è·¯">ä¸€å¼€å§‹çš„æ€è·¯</h3>

<p>ä¸€å¼€å§‹æˆ‘çš„æ€è·¯æœ‰ç‚¹æœ‰é—®é¢˜,æˆ‘åˆ†æˆäº†2ä¸ª<code class="highlighter-rouge">task</code>:</p>
<ol>
  <li><code class="highlighter-rouge">mvn install</code>ç§æœ‰ä¾èµ–</li>
  <li><code class="highlighter-rouge">mvn install</code>ä¸»ä½“é¡¹ç›®</li>
</ol>

<p>è§mavenåˆ†æ”¯çš„<code class="highlighter-rouge">concourse-ci-pipeline-1.yaml</code>æ–‡ä»¶</p>

<p>æ•ˆæœä¸æ˜¯å¾ˆç†æƒ³.è™½ç„¶ç”¨cachesç¼“å­˜äº†ä¾èµ–åŒ…,ä½†æ˜¯2ä¸ª<code class="highlighter-rouge">task</code>ä¹‹é—´æ˜¯é€šè¿‡cpæ“ä½œè¿è´¯èµ·æ¥çš„.å…¶å®åº”è¯¥æŠŠ2ä¸ªtaskåˆä¸ºä¸€ä¸ª,è¿™æ ·å°±ä¸å­˜åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢çš„é—®é¢˜.</p>

<h3 id="æ”¹è¿›ç‰ˆçš„æ€è·¯">æ”¹è¿›ç‰ˆçš„æ€è·¯</h3>

<p>è§masteråˆ†æ”¯çš„<code class="highlighter-rouge">concourse-ci-pipeline-2.yaml</code>æ–‡ä»¶.</p>

<p>è¿™ä¸ªé¡¹ç›®masterç”¨çš„gradle,mavenç‰ˆæœ¬çš„åœ¨mavenåˆ†æ”¯.</p>

<h2 id="concourse-ciçš„ä¸€äº›ç”¨æ³•">Concourse-CIçš„ä¸€äº›ç”¨æ³•</h2>

<p>ä»¥æˆ‘è¿™ä¸ªé¡¹ç›®ä¸ºä¾‹</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>fly  <span class="nt">-t</span> zeusro set-pipeline <span class="nt">-p</span> spring-boot-template <span class="nt">-c</span> concourse-ci-pipeline.yaml <span class="se">\</span>
<span class="nt">-v</span> <span class="s2">"name=spring-boot-template"</span> <span class="se">\</span>
<span class="nt">-v</span> <span class="s2">"repouri=ssh://git@github.com:zeusro/spring-boot-template.git"</span> <span class="se">\</span>
<span class="nt">-v</span> <span class="s2">"repo-key=</span><span class="si">$(</span><span class="nb">cat</span> ~/.ssh/id_rsa<span class="si">)</span><span class="s2">"</span>  <span class="se">\</span>
<span class="nt">-v</span> <span class="s2">"dependency1uri=ssh://&lt;åŸºç¡€ä¾èµ–çš„ä»“åº“&gt;"</span> <span class="se">\</span>
<span class="nt">-v</span> <span class="s2">"image-name=&lt;æ‰“åŒ…çš„é˜¿é‡Œäº‘é•œåƒåç§°&gt;"</span>  <span class="se">\</span>
<span class="nt">-v</span> <span class="s2">"image-username=&lt;ç™»å½•é•œåƒçš„ç”¨æˆ·å&gt;"</span>  <span class="se">\</span>
<span class="nt">-v</span> <span class="s1">'image-password=&lt;ç™»å½•é•œåƒçš„å¯†ç &gt;'</span>  <span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å°–æ‹¬å·ä¸­é—´çš„å†…å®¹è‡ªè¡ŒæŒ‰éœ€æ›¿æ¢å³å¯</p>

<p>å…¶å®é…ç½®è¿˜å¯ç”¨æ–‡ä»¶æ–¹å¼æŒ‡å®š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>fly -t amiba sp -p demo -c demo.yml -l demo/gradle.yml
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="/img/in-post/concourse-ci/30BA710A5D04F0CD5E5B9C222FB34A33.jpg" alt="image" /></p>

<p>æ‰§è¡Œsqä¹‹å,</p>
<ol>
  <li>web UIç›¸åº”çš„<code class="highlighter-rouge">Pipelines</code>ä¸Šç‚¹æ’­æ”¾é”®;</li>
  <li><code class="highlighter-rouge">fly -t zeusro trigger-job --job spring-boot-demo/dev-build</code>æ‰‹åŠ¨è§¦å‘.</li>
  <li><code class="highlighter-rouge">resources</code>çš„ç‰¹å®šäº‹ä»¶</li>
  <li></li>
</ol>

<p>è¿™äº›éƒ½èƒ½å¤Ÿè§¦å‘ç›¸åº”<code class="highlighter-rouge">Pipelines</code>çš„æ‰§è¡Œ.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>fly -t zeusro watch --job spring-boot-demo/dev-build --build 2
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¿™ä¸ªæ˜¯å®æ—¶æŸ¥çœ‹å‘½ä»¤çš„è¾“å‡ºä¿¡æ¯</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>fly -t zeusro abort-build --job spring-boot-demo/dev-build --build 1
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¿™ä¸ªå‘½ä»¤æ˜¯åºŸæ­¢ç‰¹å®šæ„å»º</p>

<h3 id="å¥½ç”¨çš„å‘½ä»¤é›†é”¦">å¥½ç”¨çš„å‘½ä»¤é›†é”¦</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>fly <span class="nt">-h</span>
fly <span class="nt">-t</span> zeusro builds
fly <span class="nt">-t</span> zeusro watch <span class="nt">--job</span> spring-boot-demo/dev-build <span class="nt">--build</span> 2
fly <span class="nt">-t</span> zeusro abort-build <span class="nt">--job</span> spring-boot-demo/dev-build <span class="nt">--build</span> 1
fly <span class="nt">-t</span> zeusro trigger-job <span class="nt">--job</span> spring-boot-demo/dev-build
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="å¤‡æ³¨">å¤‡æ³¨</h2>

<ol>
  <li>è¦ç•™æ„dockerfileé‡Œé¢alpine,gradle,mvnçš„ç‰ˆæœ¬,é¿å…è¯¯äº‹</li>
</ol>

<p>é»˜è®¤çš„<code class="highlighter-rouge">gradle</code>cacheåœ¨</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>/root/.gradle/caches/modules-2/files-2.1/
</pre></td></tr></tbody></table></code></pre></div></div>

<p>é»˜è®¤çš„<code class="highlighter-rouge">maven</code>repositoryåœ¨</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>/root/.m2/repository/
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="ç»“è®º">ç»“è®º</h2>

<blockquote>
  <p>è¿™ç©æ„çœŸä»–å¦ˆå‘çˆ¹,æœ‰é—®é¢˜å„ä½è‡ªå·±è§£å†³,è°çˆ±æè°å»~</p>
</blockquote>

<h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥:</h2>

<ol>
  <li><a href="https://concoursetutorial.com/">Introduction to Concourse</a></li>
  <li><a href="https://yq.aliyun.com/articles/178450">åœ¨é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡ä¸Šï¼Œè½»æ¾æ­å»ºConcourse CI</a></li>
  <li><a href="http://www.10tiao.com/html/341/201807/2651202189/1.html">å®æˆ˜ï¼šç”¨Concourseå®ç°ç«¯åˆ°ç«¯çš„è“ç»¿éƒ¨ç½²</a></li>
  <li><a href="http://ju.outofmemory.cn/entry/305358">Concourseå­¦ä¹ ï¼šä»‹ç»å’Œå®è·µ</a></li>
  <li><a href="https://github.com/bijukunjummen/ci-concourse-caching-sample">Concourse caching with Maven/Gradle</a></li>
  <li><a href="https://blog.waterstrong.me/concourse-ci/">Concourse CI ä»‹ç»</a></li>
  <li><a href="http://www.infoq.com/cn/news/2016/05/concourse">Concourseï¼šå¯æ‰©å±•çš„å¼€æºCIç®¡é“å·¥å…·</a></li>
</ol>
:ET
I"›\<p><img src="/img/in-post/improve-mysql/640.webp" alt="image" /></p>

<h2 id="æ…¢æŸ¥è¯¢ä¼˜åŒ–åŸºæœ¬æ­¥éª¤">æ…¢æŸ¥è¯¢ä¼˜åŒ–åŸºæœ¬æ­¥éª¤</h2>

<ol>
  <li>å…ˆè¿è¡Œçœ‹çœ‹æ˜¯å¦çœŸçš„å¾ˆæ…¢ï¼Œæ³¨æ„è®¾ç½®SQL_NO_CACHE</li>
  <li>whereæ¡ä»¶å•è¡¨æŸ¥ï¼Œé”å®šæœ€å°è¿”å›è®°å½•è¡¨ã€‚è¿™å¥è¯çš„æ„æ€æ˜¯æŠŠæŸ¥è¯¢è¯­å¥çš„whereéƒ½åº”ç”¨åˆ°è¡¨ä¸­è¿”å›çš„è®°å½•æ•°æœ€å°çš„è¡¨å¼€å§‹æŸ¥èµ·ï¼Œå•è¡¨æ¯ä¸ªå­—æ®µåˆ†åˆ«æŸ¥è¯¢ï¼Œçœ‹å“ªä¸ªå­—æ®µçš„åŒºåˆ†åº¦æœ€é«˜</li>
  <li>explainæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œæ˜¯å¦ä¸1é¢„æœŸä¸€è‡´ï¼ˆä»é”å®šè®°å½•è¾ƒå°‘çš„è¡¨å¼€å§‹æŸ¥è¯¢ï¼‰</li>
  <li>order by limit å½¢å¼çš„sqlè¯­å¥è®©æ’åºçš„è¡¨ä¼˜å…ˆæŸ¥</li>
  <li>äº†è§£ä¸šåŠ¡æ–¹ä½¿ç”¨åœºæ™¯</li>
  <li>åŠ ç´¢å¼•æ—¶å‚ç…§å»ºç´¢å¼•çš„å‡ å¤§åŸåˆ™</li>
  <li>è§‚å¯Ÿç»“æœï¼Œä¸ç¬¦åˆé¢„æœŸç»§ç»­ä»0åˆ†æ</li>
</ol>

<h2 id="mysqlæŸ¥è¯¢æŠ€å·§">mysqlæŸ¥è¯¢æŠ€å·§</h2>

<h3 id="åˆ†ææŸ¥è¯¢">åˆ†ææŸ¥è¯¢</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">explain</span>  <span class="k">select</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>explain å¯ä»¥åˆ†ææŸ¥è¯¢è¯­å¥çš„æ€§èƒ½</li>
  <li>sleepç§’</li>
</ul>

<h3 id="å˜é‡èµ‹å€¼">å˜é‡èµ‹å€¼</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>set @current =0;
select @current :=@current +1;
</pre></td></tr></tbody></table></code></pre></div></div>
<ul>
  <li>åœ¨æŸ¥è¯¢ä¸­å¯ä»¥é€šè¿‡ä½¿ç”¨:=å¯¹å˜é‡è¿›è¡Œé‡æ–°èµ‹å€¼</li>
</ul>

<h3 id="æŸ¥çœ‹æ•°æ®åº“å¤§å°">æŸ¥çœ‹æ•°æ®åº“å¤§å°</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">table_schema</span> <span class="s1">'DB Name'</span><span class="p">,</span>
        <span class="n">ROUND</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">data_length</span> <span class="o">+</span> <span class="n">index_length</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>   <span class="n">MB</span>
<span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">table_schema</span> <span class="k">order</span> <span class="k">by</span> <span class="n">MB</span> <span class="k">desc</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="utf-8çš„è¡¨é‡Œé¢æœç´¢å¸¦ä¸­æ–‡çš„æ•°æ®">utf-8çš„è¡¨é‡Œé¢æœç´¢å¸¦ä¸­æ–‡çš„æ•°æ®</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>select number from Chinese_Test where HEX(contents) REGEXP '^(..)*(E[4-9])';
</pre></td></tr></tbody></table></code></pre></div></div>

<p>the Chinese Character is from E4 to E9</p>

<h2 id="ä¸€äº›å¥—è·¯">ä¸€äº›å¥—è·¯</h2>

<h3 id="ä¸è¦ä½¿ç”¨utf-8">ä¸è¦ä½¿ç”¨â€utf-8â€</h3>

<p>utf-8ä¸æ˜¯çœŸæ­£çš„UTF-8,åº”è¯¥ä½¿ç”¨<code class="highlighter-rouge">utf8mb4</code>ä½œä¸ºæ›¿ä»£ã€‚ç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªå‚æ•°<code class="highlighter-rouge">character_set_server</code>,æ”¹ä¸º<code class="highlighter-rouge">utf8mb4</code></p>

<h3 id="æ˜¾ç¤ºæ•°æ®åº“å¼•æ“">æ˜¾ç¤ºæ•°æ®åº“å¼•æ“</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>SELECT * FROM INFORMATION_SCHEMA.ENGINES;
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="æ˜¾ç¤ºé•¿äº‹åŠ¡">æ˜¾ç¤ºé•¿äº‹åŠ¡</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>select * from information_schema.innodb_trx;
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="æš´åŠ›æ”¹è¡¨">æš´åŠ›æ”¹è¡¨</h3>

<p>æ”¹è¡¨æœŸé—´,è¿è¡Œ</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> 
    <span class="n">CONCAT</span><span class="p">(</span><span class="s1">'kill '</span><span class="p">,</span> <span class="n">thread_id</span><span class="p">,</span> <span class="s1">';'</span><span class="p">)</span>
<span class="k">FROM</span>
    <span class="p">(</span><span class="k">SELECT</span> <span class="k">DISTINCT</span>
        <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">trx_mysql_thread_id</span><span class="p">)</span> <span class="n">thread_id</span>
    <span class="k">FROM</span>
        <span class="n">information_schema</span><span class="p">.</span><span class="n">innodb_trx</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="k">SELECT</span> 
        <span class="n">id</span><span class="p">,</span> <span class="nb">time</span>
    <span class="k">FROM</span>
        <span class="n">information_schema</span><span class="p">.</span><span class="n">processlist</span>
    <span class="k">WHERE</span>
        <span class="nb">time</span> <span class="o">=</span> <span class="p">(</span><span class="k">SELECT</span> 
                <span class="k">MAX</span><span class="p">(</span><span class="nb">time</span><span class="p">)</span>
            <span class="k">FROM</span>
                <span class="n">information_schema</span><span class="p">.</span><span class="n">processlist</span>
            <span class="k">WHERE</span>
                <span class="k">state</span> <span class="o">=</span> <span class="s1">'Waiting for table metadata lock'</span>
                    <span class="k">AND</span> <span class="k">SUBSTRING</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">'alter'</span> <span class="p">,</span> <span class="s1">'optim'</span><span class="p">,</span> <span class="s1">'repai'</span><span class="p">,</span> <span class="s1">'lock '</span><span class="p">,</span> <span class="s1">'drop '</span><span class="p">,</span> <span class="s1">'creat'</span><span class="p">)))</span> <span class="n">p</span>
    <span class="k">WHERE</span>
        <span class="n">TIMESTAMPDIFF</span><span class="p">(</span><span class="k">SECOND</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">trx_started</span><span class="p">,</span> <span class="n">NOW</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">p</span><span class="p">.</span><span class="nb">time</span>
            <span class="k">AND</span> <span class="n">i</span><span class="p">.</span><span class="n">trx_mysql_thread_id</span> <span class="k">NOT</span> <span class="k">IN</span> <span class="p">(</span><span class="n">CONNECTION_ID</span><span class="p">()</span> <span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">id</span><span class="p">))</span> <span class="n">t</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æ‰§è¡Œ alter çš„åŒæ—¶, kill æ‰é™¤äº† select * from   INFORMATION_SCHEMA.innodb_trxé‡Œé¢é™¤äº† alter ä»¥å¤–çš„è¿›ç¨‹</p>

<p><code class="highlighter-rouge">PS</code>:è™½ç„¶mysql 5.7æ”¯æŒonlineDDL,ä½†æ˜¯å®æµ‹ä¿®æ”¹æ•°æ®ç±»å‹çš„æ—¶å€™ä¸æ”¯æŒDML.è¿™ä¸ªæ—¶å€™å¯ä»¥è€ƒè™‘ä½¿ç”¨<a href="https://www.percona.com/doc/percona-toolkit/LATEST/pt-online-schema-change.html">pt-online-schema-change</a>,ä¾‹å­è§<a href="http://seanlook.com/2016/05/27/mysql-pt-online-schema-change/">pt-online-schema-changeä½¿ç”¨è¯´æ˜ã€é™åˆ¶ä¸æ¯”è¾ƒ</a></p>

<p>å‚è€ƒ:
<a href="https://www.cnblogs.com/xinysu/p/6758170.html">pt-online-schema-changeçš„åŸç†è§£æä¸åº”ç”¨è¯´æ˜</a></p>

<h3 id="å…è®¸-mysql-è¿œç¨‹è®¿é—®">å…è®¸ mysql è¿œç¨‹è®¿é—®</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>vi /etc/mysql/my.cnf
```
[mysqld]
bind-address    = 0.0.0.0
```
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="ä¿®æ”¹å¤§æ•°æ®è¡¨">ä¿®æ”¹å¤§æ•°æ®è¡¨</h3>

<ol>
  <li>è¢«ä¿®æ”¹çš„è¡¨ Table A éœ€è¦æœ‰ä¸€ä¸ªè®°å½•æ—¶é—´æˆ³çš„å­—æ®µï¼Œ è¿™ä¸ªæ—¶é—´æˆ³å°±æ˜¯æ¯æ¬¡æ•°æ®æ›´æ–°ï¼Œéƒ½ä¼šæ›´æ–°çš„å­—æ®µï¼Œ è¿™ä¸ªå­—æ®µéœ€è¦æœ‰ç´¢å¼•ï¼Œåœ¨djangoé‡Œå¯ä»¥ä½¿ç”¨ auto_now=True</li>
  <li>åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸´æ—¶è¡¨ Table Bï¼Œ ä¸æ˜¯tmp_table, æ˜¯ä¸€ä¸ªæ–°çš„è¡¨ï¼Œä½†æ˜¯æ˜¯ä¸´æ—¶ä½¿ç”¨çš„ã€‚ è¿™ä¸ªè¡¨å’Œè¦ä¿®æ”¹çš„è¡¨æ‹¥æœ‰ä¸€æ¨¡ä¸€æ ·çš„æ•°æ®ç»“æ„ï¼Œ åŠ ä¸Šä½ è¦ä¿®æ”¹çš„éƒ¨åˆ†ï¼Œ æ¯”å¦‚å¢åŠ çš„å­—æ®µï¼›</li>
  <li>è®°å½•ä¸‹Table A çš„ç´¢å¼•</li>
  <li>åˆ é™¤ Table B çš„å…¨éƒ¨ç´¢å¼•</li>
  <li>æŠŠTable A çš„æ•°æ®å…¨éƒ¨å¤åˆ¶åˆ°Table B, æ˜¯ä¸æ˜¯æ‰§è¡Œ INSERT INTO B(field1, field2) SELECT field1, field2 FROM Aï¼Ÿ å½“ç„¶ä¸æ˜¯ï¼Œ è¿™ä¹ˆåšä¸è¿˜æ˜¯é”æ­»äº†Table A ä¹ˆï¼Œ è¿™é‡Œçš„è¿ç§»å°±æ˜¯ä¸€ä¸ªéœ€è¦ç»†åˆ†çš„åœ°æ–¹ï¼Œéœ€è¦å†™ä¸€ä¸ªè„šæœ¬ï¼Œ è®©ç¨‹åºæ¯æ¬¡è¯»å–æ¯”å¦‚5000æ¡æ•°æ®å‡ºæ¥ï¼Œ æ’å…¥åˆ°Table Bé‡Œé¢ï¼Œ å› ä¸ºTable B æ˜¯æ²¡æœ‰ç´¢å¼•çš„ï¼Œ æ‰€ä»¥è¦å½“å¿ƒä¸è¦ä½¿ç”¨å¤šè¿›ç¨‹æ¥åšï¼› å¦‚æœæ˜¯å¤šè¿›ç¨‹ï¼Œ è¦ç¡®ä¿æ’å…¥åˆ°Bçš„æ—¶å€™æ˜¯ä¸ä¼šæœ‰é‡å¤æ•°æ®çš„ï¼› å¦‚æœæ˜¯1000ä¸‡çš„æ•°æ®ï¼Œæ¯æ¬¡5000æ¡ï¼Œ å‡è®¾è¿™ä¸ªæ“ä½œéœ€è¦500msï¼Œ é‚£ä¹ˆ 2000*200ms = 16 åˆ†é’Ÿã€‚ è¿™åªæ˜¯ä¸€ä¸ªä¼°å€¼ï¼Œ å…·ä½“æƒ…å†µå’ŒæœåŠ¡å™¨å½“æ—¶çš„æƒ…å†µæœ‰å…³ï¼Œ ä¸å¥½ç»†è¯´ã€‚ å¦å¤–ï¼Œ æˆ‘ä»¬è¦è®°å½•è¿™ä¸ªè¿ç§»å¼€å§‹çš„æ—¶é—´ç‚¹ï¼Œè®°ä¸ºt1;
5 ä¸ºBå»ºç«‹ç´¢å¼•ï¼Œ å¾…ç´¢å¼•å…¨éƒ¨å¥½äº†ä¹‹åï¼Œ å†ç»§ç»­6</li>
  <li>é‚£ä¹ˆè¿™ä¸ªæ—¶å€™Table A çš„æ•°æ®æ˜¯ä¸æ˜¯éƒ½è¿›å…¥äº†Table B å‘¢ï¼Œ åº”å½“è¯´å·®ä¸å¤šå¤§éƒ¨åˆ†éƒ½è¿›å…¥äº†ï¼Œ ä½†5ä¸­è¯´ï¼Œ è¿™å¤§æ¦‚éœ€è¦16åˆ†é’Ÿï¼Œ è¿™ä¹ˆé•¿çš„æ—¶é—´é‡Œï¼Œ å¯èƒ½æœ‰æ–°çš„æ•°æ®è¿›å…¥äº†ï¼Œ ä¹Ÿæœ‰å¯èƒ½å·²æœ‰çš„æ•°æ®å‘ç”Ÿäº†æ›´æ–°ï¼Œ æ‰€ä»¥æˆ‘ä»¬è¦æŠŠTable A ä¸­åœ¨t1 ä¹‹åå‘ç”Ÿå˜åŒ–çš„æ•°æ®æŸ¥æ‰¾å‡ºæ¥ï¼Œ ç„¶åæ›´æ–°åˆ°Table B ä¸­ï¼Œ æˆ‘ä»¬çš„åšæ³•æ˜¯ï¼š
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre> è®°å½•è¿™ä¸ªæ“ä½œå¯¹åº”çš„æ—¶é—´ç‚¹ t2
 BEGIN;
 DELETE FROM B WHERE updated_time &gt; t1;
 INSERT INTO B(field1, field2) SELECT field1, field2 FROM A WHERE updated_time &gt;t1;
 COMMIT;
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>ç°åœ¨A å’Œ B å·®ä¸å¤šè©²åŒæ­¥äº†å§ï¼Ÿ å·®ä¸å¤šäº†ï¼Œ ä½†æ˜¯6 æ‰§è¡Œå®Œä¹‹åï¼Œ Aä»ç„¶åœ¨å†™ï¼Œ å­å­å­™å­™æ— ç©·å°½ä¹Ÿ â€¦ , ä½†è¿™ä¸ªæ—¶å€™ A å’Œ B çš„å·®å¼‚å·²ç»éå¸¸éå¸¸å°äº†ï¼Œ æ‰€ä»¥åœ¨ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªtransaction é‡Œæ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼š
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre> BEGIN;
 DELETE FROM B WHERE updated_time &gt; t2;
 INSERT INTO B(field1, field2) SELECT field1, field2 FROM A WHERE updated_time &gt;t2;

 ALTER TABLE A RENAME TO C;
 ALTER TABLE B RENAME TO A;
 COMMIT;
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
</ol>

<h2 id="mysql-workbech">MySQL Workbech</h2>

<h3 id="å…è®¸updateä¸whereæ›´æ–°">å…è®¸updateä¸whereæ›´æ–°</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>SET SQL_SAFE_UPDATES = 0;
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="å®¢æˆ·ç«¯æç¤º">å®¢æˆ·ç«¯æç¤º</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>Error Code: 2013. Lost connection to MySQL server during query
Error Code: 2006. MySQL server has gone away

Go to Edit -&gt; Preferences -&gt; SQL Editor and set to a higher value this parameter: DBMS connection read time out (in seconds). For instance: 86400.
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="ä¿®æ”¹ä¸ºf5æ‰§è¡Œé€‰ä¸­å½“å‰é€‰ä¸­è¯­å¥">ä¿®æ”¹ä¸ºF5æ‰§è¡Œé€‰ä¸­å½“å‰é€‰ä¸­è¯­å¥</h3>

<p>æ–¹æ³•:ä¿®æ”¹C:\Program Files\MySQL\MySQL Workbench 6.3 CE\data\main_menu.xmlé‡Œé¢çš„å†…å®¹</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>
        <span class="nt">&lt;value</span> <span class="na">type=</span><span class="s">"object"</span> <span class="na">struct-name=</span><span class="s">"app.MenuItem"</span> <span class="na">id=</span><span class="s">"com.mysql.wb.menu.query.execute_current_statementwin"</span><span class="nt">&gt;</span> 
          <span class="nt">&lt;link</span> <span class="na">type=</span><span class="s">"object"</span> <span class="na">key=</span><span class="s">"owner"</span> <span class="na">struct-name=</span><span class="s">"app.MenuItem"</span><span class="nt">&gt;</span>com.mysql.wb.menu.query<span class="nt">&lt;/link&gt;</span> 
          <span class="nt">&lt;value</span> <span class="na">type=</span><span class="s">"string"</span> <span class="na">key=</span><span class="s">"caption"</span><span class="nt">&gt;</span>Execute Current Statement<span class="nt">&lt;/value&gt;</span> 
          <span class="nt">&lt;value</span> <span class="na">type=</span><span class="s">"string"</span> <span class="na">key=</span><span class="s">"name"</span><span class="nt">&gt;</span>query.execute_current_statement<span class="nt">&lt;/value&gt;</span> 
          <span class="nt">&lt;value</span> <span class="na">type=</span><span class="s">"string"</span> <span class="na">key=</span><span class="s">"command"</span><span class="nt">&gt;</span>builtin:query.execute_current_statement<span class="nt">&lt;/value&gt;</span> 
          <span class="nt">&lt;value</span> <span class="na">type=</span><span class="s">"string"</span> <span class="na">key=</span><span class="s">"itemType"</span><span class="nt">&gt;</span>action<span class="nt">&lt;/value&gt;</span> 
          <span class="nt">&lt;value</span> <span class="na">type=</span><span class="s">"string"</span> <span class="na">key=</span><span class="s">"shortcut"</span><span class="nt">&gt;</span>F5<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;value</span> <span class="na">type=</span><span class="s">"string"</span> <span class="na">key=</span><span class="s">"platform"</span><span class="nt">&gt;</span>windows<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/value&gt;</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="æ•…éšœå¤„ç†">æ•…éšœå¤„ç†</h2>

<h3 id="å¿˜è®°å¯†ç ">å¿˜è®°å¯†ç </h3>

<ul>
  <li>mysql 5.7 Ubuntu 64</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>service mysql status
<span class="nb">sudo </span>service mysql stop
<span class="nb">mkdir</span> <span class="nt">-p</span> /var/run/mysqld
<span class="nb">chown </span>mysql:mysql /var/run/mysqld
<span class="nb">sudo </span>mysqld_safe <span class="nt">--skip-grant-tables</span> <span class="nt">--skip-networking</span> &amp;  
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>mysql <span class="nt">-u</span> root <span class="nt">--socket</span><span class="o">=</span>/tmp/mysql.sock
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">use</span> <span class="n">mysql</span><span class="p">;</span> 
<span class="k">update</span> <span class="k">user</span> <span class="k">set</span> <span class="n">authentication_string</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">(</span><span class="nv">"aaaaaaaaaaa"</span><span class="p">)</span> <span class="k">where</span> <span class="k">User</span><span class="o">=</span><span class="s1">'root'</span><span class="p">;</span>
<span class="n">flush</span> <span class="k">privileges</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>sudo service mysql restart
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="ç£ç›˜å·²æ»¡">ç£ç›˜å·²æ»¡</h3>

<p>é˜¿é‡Œäº‘çš„RDS,ç£ç›˜æ»¡äº†ï¼Œä¼šå‡ºç° <code class="highlighter-rouge">--rds-read-drop-only</code> çŠ¶æ€ã€‚æ­¤æ—¶åªèƒ½è¯»å–æ•°æ®æˆ–è€…åˆ åº“ï¼ˆæ¯•ç«Ÿå‡çº§ç£ç›˜è¦é‡å¯ï¼‰ã€‚</p>

<p>æ­¤æ—¶æœ€å¿«çš„è§£å†³åŠæ³•æ˜¯åˆ åº“ã€‚</p>

<p>é€€è€Œæ±‚å…¶æ¬¡ï¼Œè½¬ç§»æ•°æ®åº“ï¼Œç„¶ååˆ åº“ã€‚</p>

<p>æˆ–è€…åœ¨ä¸šåŠ¡ä½å³°æœŸä¼˜åŒ–æ•°æ®è¡¨ç»“æ„</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> 
    <span class="n">ROW_FORMAT</span><span class="p">,</span>
    <span class="n">TABLE_ROWS</span><span class="p">,</span>
    <span class="n">DATA_LENGTH</span><span class="p">,</span>
    <span class="n">INDEX_LENGTH</span><span class="p">,</span>
    <span class="n">MAX_DATA_LENGTH</span><span class="p">,</span>
    <span class="n">DATA_FREE</span><span class="p">,</span>
    <span class="n">TABLE_SCHEMA</span><span class="p">,</span>
    <span class="k">TABLE_NAME</span><span class="p">,</span>
    <span class="n">ENGINE</span>
<span class="k">FROM</span>
    <span class="n">information_schema</span><span class="p">.</span><span class="n">TABLES</span>
    <span class="k">order</span> <span class="k">by</span> <span class="n">data_free</span> <span class="k">desc</span><span class="p">,</span> <span class="k">TABLE_NAME</span>

<span class="n">OPTIMIZE</span> <span class="k">TABLE</span>  <span class="n">db</span><span class="p">.</span><span class="n">tables</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>é‡Šæ”¾é‚£äº›æ— æ•ˆçš„ç©ºé—´</p>

<h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h2>

<ol>
  <li><a href="https://dev.mysql.com/doc/refman/8.0/en/table-locking.html"> Table Locking Issues</a></li>
  <li><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html">privileges-provided</a></li>
  <li><a href="https://help.aliyun.com/knowledge_detail/41723.html">RDS MySQL è¡¨ä¸Š Metadata lock çš„äº§ç”Ÿå’Œå¤„ç†</a></li>
  <li><a href="https://www.cnblogs.com/digdeep/p/4892953.html">MySQLå‡ºç°Waiting for table metadata lockçš„åŸå› ä»¥åŠè§£å†³æ–¹æ³•</a></li>
  <li><a href="https://www.digitalocean.com/community/questions/how-to-allow-remote-mysql-database-connection">How to Allow Remote MySQL Database Connection</a></li>
  <li><a href="https://blog.csdn.net/lovemysea/article/details/79121154">è§£å†³Lost connection to MySQL server during queryé”™è¯¯æ–¹æ³•</a></li>
  <li><a href="https://blog.csdn.net/juan083/article/details/54889893">mysqlçš„show processlistå‘½ä»¤å¤§ä½œç”¨</a></li>
  <li><a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html">Privileges Provided by MySQL</a></li>
  <li><a href="http://www.infoq.com/cn/articles/in-mysql-never-use-utf8-use-utf8">è®°ä½ï¼Œæ°¸è¿œä¸è¦åœ¨MySQLä¸­ä½¿ç”¨â€œutf8â€</a></li>
  <li><a href="https://yq.aliyun.com/articles/66680">MySQLç´¢å¼•åŸç†åŠæ…¢æŸ¥è¯¢ä¼˜åŒ–</a></li>
  <li><a href="https://www.v2ex.com/t/44841">Mysql å¦‚ä½•ä¿®æ”¹å¤§æ•°æ®è¡¨</a></li>
  <li><a href="https://blog.csdn.net/leshami/article/details/39801867">MySQL äºŒè¿›åˆ¶æ—¥å¿—(Binary Log)</a></li>
  <li><a href="https://stackoverflow.com/questions/1733507/how-to-get-size-of-mysql-database">how-to-get-size-of-mysql-database</a></li>
  <li><a href="https://stackoverflow.com/questions/9795137/how-to-detect-rows-with-chinese-characters-in-mysql">How to detect rows with chinese characters in MySQL?</a></li>
  <li><a href="https://help.aliyun.com/knowledge_list/41698.html">äº‘æ•°æ®åº“ RDS ç‰ˆ &gt; æŠ€æœ¯è¿ç»´é—®é¢˜ &gt; MYSQLä½¿ç”¨</a></li>
  <li><a href="https://zhuanlan.zhihu.com/p/30743094">mysql: show processlist è¯¦è§£</a></li>
  <li><a href="http://www.ywnds.com/?p=9337">MySQL SHOW PROCESSLISTååŠ©æ•…éšœè¯Šæ–­</a></li>
  <li><a href="http://blog.csdn.net/Z_YTTT/article/details/73650495">è§£å†³mysqld_safe Directory â€˜/var/run/mysqldâ€™ for UNIX socket file donâ€™t exists</a></li>
  <li><a href="http://blog.csdn.net/u010603691/article/details/50379282">MySQL5.7æ›´æ”¹å¯†ç æ—¶å‡ºç°ERROR 1054 (42S22): Unknown column â€˜passwordâ€™ in â€˜field listâ€™</a></li>
  <li><a href="https://www.yiibai.com/mysql/create-user.html">create-user</a></li>
  <li><a href="https://www.yiibai.com/mysql/grant.html">GRANT</a></li>
  <li><a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_all">privileges-provided</a></li>
  <li><a href="https://www.cnblogs.com/chanshuyi/p/mysql_user_mng.html">MySQLç”¨æˆ·ç®¡ç†ï¼šæ·»åŠ ç”¨æˆ·ã€æˆæƒã€åˆ é™¤ç”¨æˆ·</a></li>
  <li><a href="https://www.kancloud.cn/thinkphp/mysql-design-optimalize/39320">è¯¦è§£æ…¢æŸ¥è¯¢</a></li>
  <li><a href="https://mp.weixin.qq.com/s/69XIz-UhuQTZ44InJEL98w">MySQL æ•°æ®åº“ä¼˜åŒ–ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº†</a></li>
</ol>

<h3 id="é˜¿é‡Œäº‘">é˜¿é‡Œäº‘</h3>

<ol>
  <li><a href="https://help.aliyun.com/document_detail/63255.html">å‚æ•°è°ƒä¼˜å»ºè®®</a></li>
  <li><a href="https://yq.aliyun.com/articles/338423">10åˆ†é’Ÿæ­å»ºMySQL Binlogåˆ†æ+å¯è§†åŒ–æ–¹æ¡ˆ</a></li>
  <li><a href="https://help.aliyun.com/knowledge_detail/51682.html">å¦‚ä½•æ’æŸ¥MySQLå®ä¾‹ç©ºé—´æ»¡åè‡ªåŠ¨é”å®šçš„åŸå› </a></li>
</ol>
:ET
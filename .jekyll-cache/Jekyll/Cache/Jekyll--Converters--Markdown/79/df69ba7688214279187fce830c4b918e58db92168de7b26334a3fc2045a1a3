I"¨<h2 id="æœ€å¤§çš„å‘æ˜¯-deprecated-apiversion">æœ€å¤§çš„å‘æ˜¯ deprecated apiVersion</h2>

<p><code class="highlighter-rouge">Kubernetes</code> çš„ <code class="highlighter-rouge">apiVersion</code> æ˜¯ä¼šè¿‡æœŸçš„</p>

<p>ä»¥ 1.16æ¥è¯´,<code class="highlighter-rouge">DaemonSet</code>, <code class="highlighter-rouge">Deployment</code>, <code class="highlighter-rouge">StatefulSet</code>, <code class="highlighter-rouge">ReplicaSet</code> å…¨éƒ¨ç»Ÿä¸€ä½¿ç”¨ <code class="highlighter-rouge">apps/v1</code></p>

<p><code class="highlighter-rouge">NetworkPolicy</code>  ä½¿ç”¨ <code class="highlighter-rouge">networking.k8s.io/v1</code></p>

<p><code class="highlighter-rouge">PodSecurityPolicy</code> ä½¿ç”¨ <code class="highlighter-rouge">networking.k8s.io/v1</code></p>

<p>æ‰€ä»¥,åœ¨ <code class="highlighter-rouge">1.16</code> ä¸­ä½¿ç”¨ <code class="highlighter-rouge">apps/v1beta2</code>, <code class="highlighter-rouge">extensions/v1beta1</code> ç­‰åºŸå¼ƒAPIéƒ½ä¼šå‡ºé”™</p>

<h2 id="æ‹¥æŠ±å˜åŒ–">æ‹¥æŠ±å˜åŒ–</h2>

<h3 id="æ£€æŸ¥å—å½±å“èµ„æº">æ£€æŸ¥å—å½±å“èµ„æº</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>kubectl get NetworkPolicy,PodSecurityPolicy,DaemonSet,Deployment,ReplicaSet <span class="se">\</span>
<span class="nt">--all-namespaces</span> <span class="se">\</span>
<span class="nt">-o</span> <span class="s1">'jsonpath={range .items[*]}{.metadata.annotations.kubectl\.kubernetes\.io/last-applied-configuration}{"\n"}{end}'</span> | <span class="nb">grep</span> <span class="s1">'"apiVersion":"extensions/v1beta1"'</span>

kubectl get DaemonSet,Deployment,StatefulSet,ReplicaSet <span class="se">\</span>
<span class="nt">--all-namespaces</span> <span class="se">\</span>
<span class="nt">-o</span> <span class="s1">'jsonpath={range .items[*]}{.metadata.annotations.kubectl\.kubernetes\.io/last-applied-configuration}{"\n"}{end}'</span> | <span class="nb">grep</span> <span class="s1">'"apiVersion":"apps/v1beta'</span>

kubectl get <span class="nt">--raw</span><span class="o">=</span><span class="s2">"/metrics"</span> | <span class="nb">grep </span>apiserver_request_count | <span class="nb">grep</span> <span class="s1">'group="extensions"'</span> | <span class="nb">grep</span> <span class="s1">'version="v1beta1"'</span> | <span class="nb">grep</span> <span class="nt">-v</span> ingresses | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s1">'client="hyperkube'</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s1">'client="kubectl'</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s1">'client="dashboard'</span>

kubectl get <span class="nt">--raw</span><span class="o">=</span><span class="s2">"/metrics"</span> | <span class="nb">grep </span>apiserver_request_count | <span class="nb">grep</span> <span class="s1">'group="apps"'</span> | <span class="nb">grep</span> <span class="s1">'version="v1beta'</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s1">'client="hyperkube'</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s1">'client="kubectl'</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s1">'client="dashboard'</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="recreate">recreate</h3>

<p>æ˜¯çš„ï¼Œä½ æ²¡æœ‰å¬é”™ï¼Œåªèƒ½åˆ é™¤åé‡å»ºã€‚</p>

<p>æˆ‘çš„å»ºè®®æ˜¯ï¼Œåœ¨ä¸šåŠ¡ä½å³°æœŸï¼Œå»ºåŒlabel deploy è¦†ç›–æ—§çš„<code class="highlighter-rouge">resource</code>ï¼Œæ—§çš„<code class="highlighter-rouge">resource</code>ç¼©å®¹è‡³0,å¹¶åŠ ä¸Š<code class="highlighter-rouge">deprecated:true</code>çš„<code class="highlighter-rouge">label</code>è§‚å¯Ÿä¸€æ®µæ—¶é—´å,å†å½»åº•åˆ é™¤.</p>

<h2 id="åè®°">åè®°</h2>

<p>apiVersion å˜åŠ¨çš„é¢‘ç¹,åœ¨æŸç§ç¨‹åº¦ä¸Šä¹Ÿå¯ä»¥è¯æ˜ <code class="highlighter-rouge">Kubernetes</code> åœ¨å®¹å™¨è°ƒåº¦æ–¹é¢çš„éœ¸æƒâ€”â€”æ¯•ç«Ÿï¼Œå¦‚æœä½ è·Ÿå¥³æœ‹å‹åˆ†æ‰‹äº†ï¼Œä¹Ÿä¸ä¼šæƒ³ç»™å¥¹ä¹°æ–°è¡£æœï¼Œå¯¹å§ï¼Ÿ</p>

<p><img src="/img/sticker/äº‘åŸç”Ÿå¼€å‘.gif" alt="" /></p>

<h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥:</h2>

<ol>
  <li><a href="https://stackoverflow.com/questions/56386647/error-at-least-one-of-apiversion-kind-and-name-was-changed">error: At least one of apiVersion, kind and name was changed</a></li>
  <li><a href="https://www.ibm.com/cloud/blog/announcements/kubernetes-version-1-16-removes-deprecated-apis">Kubernetes Version 1.16 Removes Deprecated APIs</a></li>
  <li><a href="https://yq.aliyun.com/articles/739120">Kubernetes v1.17 ç‰ˆæœ¬è§£è¯»</a></li>
  <li><a href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md">API Conventions</a></li>
  <li><a href="https://kubernetes.io/docs/reference/using-api/deprecation-policy/">Kubernetes Deprecation Policy</a></li>
</ol>
:ET
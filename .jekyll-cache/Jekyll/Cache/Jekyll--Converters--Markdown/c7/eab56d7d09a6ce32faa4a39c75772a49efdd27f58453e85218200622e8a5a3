I"›‚<p>åœ¨ç¿»é˜…kubernetesçš„æ–‡æ¡£æ—¶ï¼Œé‡Œé¢åˆšå¥½è°ˆåˆ°goä¸€äº›æ³¨æ„äº‹é¡¹ã€‚</p>

<p>ç»“åˆä»¥å‰é‡è¿‡çš„å‘çˆ¹API,æ±‡æˆæ­¤æ–‡.</p>

<h2 id="è¯­è¨€ç‰¹æ€§">è¯­è¨€ç‰¹æ€§</h2>

<h3 id="æ•°æ®åˆ‡ç‰‡">æ•°æ®åˆ‡ç‰‡</h3>

<p>åŸåˆ™æ˜¯å–ä¸‹æ ‡,ä¸å–ä¸Šæ ‡</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>	<span class="n">a</span><span class="o">:=</span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">}</span>
	<span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="o">:</span><span class="p">]</span>
	<span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">4</span><span class="p">]</span> <span class="c">//ä»ç¬¬[2]ä½èµ·å–,ç›´è‡³[4-1]ä½,æ‰€ä»¥ç»“æœåªæœ‰2ä¸ªå…ƒç´ </span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"len(a):%d ; cap(a):%d; values:%v </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="nb">cap</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="n">a</span><span class="p">)</span> 
	<span class="c">//len(a):2 ; cap(a):3; values:[2 3]</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æ•°ç»„åˆ‡ç‰‡æ˜¯ä¸€ç§æŒ‡é’ˆ,æ‰€ä»¥æ‰ä¼šå¼•ç”³å‡ºlen/cap/appendçš„é—®é¢˜</p>

<h3 id="lencapappendçš„é—®é¢˜">len/cap/appendçš„é—®é¢˜</h3>

<p>å…³äºlen/capçš„é—®é¢˜å¯ä»¥çœ‹ä¸‹é¢2ç¯‡æ–‡ç« </p>

<ol>
  <li><a href="https://tour.golang.org/moretypes/11">Slice length and capacity</a></li>
  <li><a href="https://blog.golang.org/go-slices-usage-and-internals">Go Slices: usage and internals</a></li>
</ol>

<p>ç®€å•åœ°è¯´,lenå°±æ˜¯å½“å‰æ•°ç»„/åˆ‡ç‰‡å®é™…å…ƒç´ çš„è®¡æ•°,capæ˜¯åº•å±‚æ•°ç»„çš„é•¿åº¦,ç å¤´ä¸ç å°¾</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>	<span class="n">a</span> <span class="o">:=</span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">)</span> 
	<span class="c">// a[2]=666  //panic: runtime error: index out of range</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"len(a):%d ; cap(a):%d; values:%v </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="nb">cap</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="n">a</span><span class="p">)</span> 
	<span class="c">// len(a):2 ; cap(a):3; values:[0 0] </span>
	<span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="p">]</span>
	<span class="c">// ç¬¬0ä½æ²¡äº†,ä½†æ˜¯åé¢çš„è¿˜åœ¨,æ‰€ä»¥cap=3-1</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"len(a):%d ; cap(a):%d; values:%v </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="nb">cap</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="n">a</span><span class="p">)</span> 
	<span class="c">// len(a):1 ; cap(a):2; values:[0] </span>
	<span class="n">a</span><span class="o">=</span><span class="nb">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="m">2</span><span class="p">)</span>
	<span class="n">a</span><span class="o">=</span><span class="nb">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"len(a):%d ; cap(a):%d; values:%v </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="nb">cap</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="n">a</span><span class="p">)</span> 
	<span class="c">//len(a):3 ; cap(a):4; values:[0 2 3]</span>
	<span class="n">b</span><span class="o">:=</span><span class="nb">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="m">4</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"len(a):%d ; cap(a):%d; values:%v </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="nb">cap</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="n">a</span><span class="p">)</span> 
	<span class="c">// len(a):3 ; cap(a):4; values:[0 2 3] </span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"len(b):%d ; cap(b):%d; values:%v </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span><span class="nb">cap</span><span class="p">(</span><span class="n">b</span><span class="p">),</span><span class="n">b</span><span class="p">)</span> 
	<span class="c">// len(b):4 ; cap(b):4; values:[0 2 3 4]</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="highlighter-rouge">append</code>æ˜¯åœ¨æ•°ç»„æœ«å°¾è¿½åŠ å…ƒç´ ,è¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„,åŸæ•°ç»„ä¸ä¼šå‘ç”Ÿæ”¹å˜.</p>

<p>len=capæ—¶,ç»§ç»­<code class="highlighter-rouge">append</code>,capä¼šç¿»å€</p>

<h3 id="ä¸ä¼šç”¨deferå°±åˆ«çè£…é€¼">ä¸ä¼šç”¨deferå°±åˆ«çè£…é€¼</h3>

<p><code class="highlighter-rouge">defer</code>æ˜¯å€’åºæ‰§è¡Œ,è€Œä¸”åå®šä¹‰çš„<code class="highlighter-rouge">defer</code>å…ˆæ‰§è¡Œ(è¿™ä¸ªå¾ˆå¥½ç†è§£,å…ˆå®šä¹‰Aå˜é‡,ç„¶åå®šä¹‰Bå˜é‡ï¼ŒAçš„ä½œç”¨åŸŸæ¯”Bé•¿ï¼Œå…ˆæ¸…ç†Bæ˜¯æ­£ç¡®é€‰æ‹©).</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>	<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="m">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="k">defer</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>              <span class="c">// OK; prints 9 ... 0</span>
		<span class="k">defer</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">}()</span> <span class="c">// WRONG; prints "10" 10 times</span>
		<span class="k">defer</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c">//è·Ÿä¸‹é¢ä¸€è¡Œç»“æœä¸€æ ·</span>
		<span class="k">defer</span> <span class="k">func</span><span class="p">(</span><span class="n">i</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">}(</span><span class="n">i</span><span class="p">)</span> <span class="c">// OK  prints 0 ... 9 in</span>
		<span class="k">defer</span> <span class="nb">print</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i</span><span class="p">)</span>                         <span class="c">// WRONG; prints "10" 10 times unpredictable order</span>
		<span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">}()</span>          <span class="c">// WRONG; totally unpredictable.</span>
	<span class="p">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¿™ä¸ªä¾‹å­æ˜¯<a href="https://gist.github.com/lavalamp/4bd23295a9f32706a48f">The Three Go Landmines.markdown</a>æå‡ºæ¥çš„ã€‚è¦ç†è§£å…¶å®ä¸éš¾ï¼ŒæŠŠforæ‹†è§£å‡ºæ¥å°±è¡Œäº†ã€‚æ³¨æ„foråªæ˜¯æ§åˆ¶äº†å¾ªç¯çš„è¾¹ç•Œ,å¾ªç¯ç»“æŸå,i=10.</p>

<p>éœ€è¦åˆ†æ¸…çš„ä¼ å…¥å‚æ•°çš„æƒ…å†µ</p>

<p><code class="highlighter-rouge">defer func() { fmt.Println(i) }()</code>
ç›¸å½“äº</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="n">i</span><span class="o">:=</span><span class="m">0</span>
<span class="k">defer</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">}()</span>
<span class="n">i</span><span class="o">=</span><span class="m">1</span>
<span class="k">defer</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">}()</span>
<span class="o">......</span>
<span class="n">i</span><span class="o">=</span><span class="m">9</span>
<span class="k">defer</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">}()</span>
<span class="n">i</span><span class="o">=</span><span class="m">10</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æ‰€ä»¥<code class="highlighter-rouge">defer func() { fmt.Println(i) }()</code>çš„ç»“æœä¸ºæ‰“å°10æ¬¡10</p>

<p>è€Œ<code class="highlighter-rouge">defer fmt.Println(i)</code>ç­‰ä»·äº<code class="highlighter-rouge">defer func(i int) { fmt.Println(i) }(i)</code></p>

<p>æŠŠå±€éƒ¨å˜é‡ä¼ å…¥,deferå†…éƒ¨è·å¾—çš„æ˜¯å€¼çš„å¤åˆ¶,æ‰€ä»¥å®é™…ä¸Šæ˜¯</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="n">i</span><span class="o">:=</span><span class="m">0</span>
<span class="k">defer</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="n">i</span><span class="o">=</span><span class="m">1</span>
<span class="k">defer</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
<span class="o">......</span>
<span class="n">i</span><span class="o">=</span><span class="m">9</span>
<span class="k">defer</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="m">9</span><span class="p">)</span>
<span class="n">i</span><span class="o">=</span><span class="m">10</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¿˜æœ‰æ— æ³•å®šä¹‰å˜é‡è·å–deferå‡½æ•°çš„è¿”å›å€¼ï¼Œdeferå‡½æ•°å¸¦è¿”å›å€¼æ ¹æœ¬æ¯«æ— æ„ä¹‰</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>
	<span class="k">defer</span> <span class="k">func</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
		<span class="k">if</span> <span class="n">str</span> <span class="o">:=</span> <span class="s">"e"</span><span class="p">;</span> <span class="n">str</span> <span class="o">==</span> <span class="s">"e"</span> <span class="p">{</span>
			<span class="k">return</span> <span class="n">str</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="s">"e"</span>
	<span class="p">}()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="ifå˜é‡ä½œç”¨åŸŸ">ifå˜é‡ä½œç”¨åŸŸ</h3>

<p>if é‡Œé¢å®šä¹‰çš„å˜é‡ï¼Œå³ä¾¿æ˜¯è·Ÿå·²å®šä¹‰å˜é‡åŒåï¼Œåœ¨ifä¸­å¯¹å…¶èµ‹å€¼ï¼Œå¯¹å·²ç»è¢«å®šä¹‰çš„å˜é‡ä¸ä¼šæœ‰å½±å“ã€‚</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">var</span> <span class="n">ErrDidNotWork</span> <span class="o">=</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"did not work"</span><span class="p">)</span>

<span class="k">func</span> <span class="n">DoTheThing</span><span class="p">(</span><span class="n">reallyDoIt</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="n">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="n">reallyDoIt</span> <span class="p">{</span>
    <span class="n">result</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">tryTheThing</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="o">||</span> <span class="n">result</span> <span class="o">!=</span> <span class="s">"it worked"</span> <span class="p">{</span>
      <span class="n">err</span> <span class="o">=</span> <span class="n">ErrDidNotWork</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="åŠæ–°ä¸æ—§å˜é‡">åŠæ–°ä¸æ—§å˜é‡</h3>

<p>å¸¸è§äºerrå’Œå¤šé‡è¿”å›å€¼å‡½æ•°ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå¯ä»¥é€šè¿‡ifä½œç”¨åŸŸå¼ºåˆ¶è¦†ç›–ï¼Œæˆ–è€…å‘½åä¸€ä¸ªæ–°å˜é‡è§£å†³</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="k">var</span> <span class="n">e</span> <span class="kt">error</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">s</span><span class="p">,</span> <span class="n">e</span> <span class="o">:=</span> <span class="n">a</span><span class="p">()</span> <span class="c">//æ— æ³•ç¼–è¯‘</span>
	<span class="n">s</span><span class="p">,</span> <span class="n">err2</span> <span class="o">:=</span> <span class="n">a</span><span class="p">()</span> <span class="c">//OK</span>
	<span class="k">if</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span> <span class="o">:=</span> <span class="n">a</span><span class="p">();</span> <span class="n">e</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span> <span class="c">//OK</span>
	<span class="p">}</span>
	<span class="err">Â·Â·Â·Â·Â·Â·</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">a</span><span class="p">()</span> <span class="p">(</span><span class="n">str</span> <span class="kt">string</span><span class="p">,</span> <span class="n">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="s">""</span><span class="p">,</span> <span class="no">nil</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="goroutine-æœºåˆ¶">goroutine æœºåˆ¶</h3>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"runtime"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">var</span> <span class="n">i</span> <span class="kt">byte</span>
	<span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="m">255</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
			<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}()</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"start"</span><span class="p">)</span>
	<span class="n">runtime</span><span class="o">.</span><span class="n">Gosched</span><span class="p">()</span>
	<span class="n">runtime</span><span class="o">.</span><span class="n">GC</span><span class="p">()</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"end"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ol>
  <li>é—®é¢˜1: è¿è¡Œçš„ç»“æœ</li>
  <li>é—®é¢˜2: å»æ‰<code class="highlighter-rouge">runtime.GC()</code>ä¹‹åçš„ç»“æœ</li>
  <li>é—®é¢˜3: å¦‚æœä½ æ˜¯goruntime,å»æ‰<code class="highlighter-rouge">fmt.Println(i)</code>ä¹‹åè¦æ€ä¹ˆä¼˜åŒ–ç¼–è¯‘</li>
</ol>

<p>ç­”æ¡ˆ:</p>

<p>Gosched() è®©å‡ºäº†CPUæ—¶é—´ç‰‡,è®© goroutine æœ‰æœºä¼šè¿è¡Œ</p>

<p>Goroutineé‡‡ç”¨çš„æ˜¯åŠæŠ¢å å¼çš„åä½œè°ƒåº¦ï¼Œåªæœ‰åœ¨å½“å‰Goroutineå‘ç”Ÿé˜»å¡æ—¶æ‰ä¼šå¯¼è‡´è°ƒåº¦</p>

<p>GC()éœ€è¦stop the world,æ‰€ä»¥ä¼šç­‰å¾…åç¨‹è¿è¡Œå®Œ</p>

<p>å¦‚æœæ²¡æœ‰ GC()è¿™ä¸ªæ–¹æ³•,åˆ™è¿è¡Œç»“æœå®Œå…¨ä¸å¯æ§</p>

<p>for é‡Œé¢ä¸€å †åºŸè¯,æœ€åˆç†çš„ä¼˜åŒ–,åº”è¯¥æ˜¯è¿åç¨‹éƒ½ä¸åˆ›å»º,å“ˆå“ˆå“ˆå“ˆå“ˆ</p>

<h2 id="å‘çˆ¹api">å‘çˆ¹API</h2>

<h3 id="è·å–å­—ç¬¦ä¸²é•¿åº¦">è·å–å­—ç¬¦ä¸²é•¿åº¦:</h3>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">len</span><span class="p">([]</span><span class="kt">rune</span><span class="p">(</span><span class="s">"æ–‡ä»¶å¤¹,å­æ–‡ä»¶å¤¹,"</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="splitçš„å‘">Splitçš„å‘</h3>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>	<span class="n">s</span> <span class="o">:=</span> <span class="n">strings</span><span class="o">.</span><span class="n">Split</span><span class="p">(</span><span class="s">"shit,"</span><span class="p">,</span> <span class="s">","</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"len(s):%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="c">//2</span>
	<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">s</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
	<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>strings.Splitçš„å­—ç¬¦ä¸²,å¦‚æœç”¨æ¥åˆ†å‰²çš„å­—ç¬¦ä¸²æ°å¥½å‡ºç°å®Œæ•´å­—ç¬¦ä¸²çš„æœ€åé¢,è·å¾—çš„æ•°ç»„é•¿åº¦ä¼š+1,è¿™ä¸ªæ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ä¼šæ˜¯ä¸€ä¸ªç©ºç™½</p>

<h3 id="æ—¶é—´è½¬æ¢å‡½æ•°">æ—¶é—´è½¬æ¢å‡½æ•°</h3>

<p>golangçš„å­—ç¬¦ä¸²è½¬æ—¥æœŸå‡½æ•°éå¸¸ä¸çµæ´»,å¹¶ä¸”æ ¼å¼åŒ–çš„å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªé­”æœ¯å˜é‡,ä»£è¡¨golangçš„é¢ä¸–æ—¶é—´â€¦</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="c">// ToTime å­—ç¬¦ä¸²è½¬golangå†…ç½®å½“åœ°æ—¶é—´</span>
<span class="k">func</span> <span class="n">ToTime</span><span class="p">(</span><span class="n">str</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="n">err</span> <span class="kt">error</span>
    <span class="n">format1</span> <span class="o">:=</span> <span class="s">"2006-01-02 15:04:05"</span>    
	<span class="n">loc</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">LoadLocation</span><span class="p">(</span><span class="s">"Local"</span><span class="p">);</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">(),</span> <span class="n">err</span>
	<span class="p">}</span>
	<span class="n">date</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">ParseInLocation</span><span class="p">(</span><span class="n">format1</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">loc</span><span class="p">);</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">==</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">date</span><span class="p">,</span> <span class="no">nil</span>
	<span class="p">}</span>
	<span class="n">format2</span> <span class="o">:=</span> <span class="s">"2006-01-02"</span>
	<span class="n">date</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">ParseInLocation</span><span class="p">(</span><span class="n">format2</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">loc</span><span class="p">);</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">==</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">date</span><span class="p">,</span> <span class="no">nil</span>
	<span class="p">}</span>
	<span class="n">sqlserverFormat</span><span class="o">:=</span> <span class="s">"2006-01-02T15:04:05"</span>
	<span class="n">date</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">ParseInLocation</span><span class="p">(</span><span class="n">sqlserverFormat</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">loc</span><span class="p">);</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">==</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">date</span><span class="p">,</span> <span class="no">nil</span>
	<span class="p">}</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">(),</span> <span class="n">err</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="å€¼ç±»å‹ä¸ä¼šæº¢å‡º">å€¼ç±»å‹ä¸ä¼šæº¢å‡º</h3>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>	<span class="k">var</span> <span class="n">s</span> <span class="kt">int32</span> <span class="o">=</span> <span class="m">5120</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="m">1024</span> <span class="o">*</span> <span class="m">1024</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="kt">int64</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">*</span> <span class="m">1024</span> <span class="o">*</span> <span class="m">1024</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">MaxInt32</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">MaxInt64</span><span class="p">)</span>
    <span class="c">/*
1073741824
5368709120
2147483647
9223372036854775807
*/</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ä»¥å‰ç”¨C#çš„æ—¶å€™,å¦‚æœå®šä¹‰ä¸€ä¸ªå€¼ç±»å‹å˜é‡,èµ‹äºˆå®ƒä¸€ä¸ªè¶…å‡ºèŒƒå›´çš„å€¼çš„è¯æ˜¯ä¼šå‡ºå¼‚å¸¸çš„,ç„¶è€Œåˆ°äº†golang,ç›´æ¥å˜æˆè¿™ä¸ªç±»å‹æ— ç¬¦å·æœ€å¤§å€¼</p>

<h2 id="æ„å»ºç¯‡">æ„å»ºç¯‡</h2>

<p>å¯ç”¨äº†<code class="highlighter-rouge">go module</code>ä¹‹åï¼Œå¯¹ä¾èµ–çš„æ‹‰å–å˜å¾—æ›´åŠ é¢‘ç¹ã€‚ä½†æ˜¯åŸºäºä¸­å›½æœ‰ä¸­å›½ç‰¹è‰²çš„äº’è”ç½‘ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™å¾ˆéš¾getåˆ°æˆ‘ä»¬éœ€è¦çš„ä¾èµ–æºä»£ç ï¼Œè¿›è€Œå¯¼è‡´é¡¹ç›®ç¼–è¯‘å¤±è´¥ï¼ŒCIå¤±è´¥ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªproxyã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">GOPROXY</span><span class="o">=</span>https://goproxy.io
</pre></td></tr></tbody></table></code></pre></div></div>

<p><a href="https://cloud.tencent.com/developer/news/308442">goproxy.io for Go modules</a></p>

<h2 id="å¼€å‘å»ºè®®">å¼€å‘å»ºè®®</h2>

<ol>
  <li><a href="https://github.com/golang/go/wiki/CodeReviewComments">CodeReviewComments</a></li>
  <li><a href="https://golang.org/doc/effective_go.html">Effective Go</a></li>
</ol>

<p>å…¶ä»–è¯­è¨€çš„å¯çœ‹
<a href="https://google.github.io/styleguide/">Google Style Guides</a></p>

<p>è®ºå–·å­ï¼Œè¿˜æ˜¯æ²¡<a href="http://www.yinwang.org/blog-cn/2014/04/18/golang">ç‹å </a>å¼º</p>

<h2 id="è¯¾åä½œä¸š">è¯¾åä½œä¸š</h2>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre>
<span class="k">func</span> <span class="n">a</span><span class="p">()</span> <span class="p">(</span><span class="n">str</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">defer</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="n">str</span> <span class="o">=</span> <span class="s">"a"</span>
	<span class="p">}()</span>

	<span class="k">defer</span> <span class="k">func</span><span class="p">(</span><span class="n">str</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">str</span> <span class="o">=</span> <span class="s">"b"</span>
	<span class="p">}(</span><span class="n">str</span><span class="p">)</span>

	<span class="k">defer</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="n">str2</span> <span class="o">:=</span> <span class="s">"c"</span><span class="p">;</span> <span class="n">str2</span> <span class="o">==</span> <span class="s">"c"</span> <span class="p">{</span>
			<span class="n">str</span> <span class="o">=</span> <span class="n">str2</span>
		<span class="p">}</span>
	<span class="p">}()</span>

	<span class="k">defer</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="n">str</span> <span class="o">:=</span> <span class="s">"d"</span><span class="p">;</span> <span class="n">str</span> <span class="o">==</span> <span class="s">"d"</span> <span class="p">{</span>
			<span class="n">str</span> <span class="o">=</span> <span class="s">"d"</span>
		<span class="p">}</span>
	<span class="p">}()</span>

	<span class="k">defer</span> <span class="k">func</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
		<span class="k">if</span> <span class="n">str</span> <span class="o">:=</span> <span class="s">"e"</span><span class="p">;</span> <span class="n">str</span> <span class="o">==</span> <span class="s">"e"</span> <span class="p">{</span>
			<span class="k">return</span> <span class="n">str</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="s">"e"</span>
	<span class="p">}()</span>

	<span class="n">str</span> <span class="o">=</span> <span class="s">"f"</span>
	<span class="k">return</span> <span class="n">str</span>
<span class="p">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>æ³¨é‡Šæ‰é‡Œé¢çš„<code class="highlighter-rouge">defer</code>ï¼Œè§‚å¯Ÿä¸€ä¸‹ä¸åŒç»„åˆä¸‹çš„å‡½æ•°çš„ç»“æœï¼Œçœ‹æ‡‚äº†ï¼Œå°±ç®—ç†è§£deferäº†</p>
:ET
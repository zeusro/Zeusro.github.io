I"´r<h2 id="å®‰è£…">å®‰è£…</h2>

<h3 id="ubuntu">Ubuntu</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="c"># SET UP THE REPOSITORY</span>
<span class="nb">sudo </span>apt-get remove docker docker-engine docker.io
<span class="nb">sudo </span>apt-get update
<span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="se">\</span>
    apt-transport-https <span class="se">\</span>
    ca-certificates <span class="se">\</span>
    curl <span class="se">\</span>
    software-properties-common
curl <span class="nt">-fsSL</span> https://download.docker.com/linux/ubuntu/gpg | <span class="nb">sudo </span>apt-key add -
<span class="nb">sudo </span>apt-key fingerprint 0EBFCD88
 <span class="nb">sudo </span>add-apt-repository <span class="se">\</span>
   <span class="s2">"deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span class="se">\</span><span class="s2">
   </span><span class="si">$(</span>lsb_release <span class="nt">-cs</span><span class="si">)</span><span class="s2"> </span><span class="se">\</span><span class="s2">
   stable"</span>
<span class="c"># INSTALL DOCKER CE</span>
 <span class="nb">sudo </span>apt-get update
 <span class="nb">sudo </span>apt-get <span class="nb">install </span>docker-ce
apt-cache madison docker-ce
<span class="c"># é˜¿é‡Œäº‘å…¬å¸é•œåƒ</span>
<span class="nb">sudo mkdir</span> <span class="nt">-p</span> /etc/docker
<span class="nb">sudo tee</span> /etc/docker/daemon.json <span class="o">&lt;&lt;-</span><span class="sh">'</span><span class="no">EOF</span><span class="sh">'
{
  "registry-mirrors": ["https://vhc6pxhv.mirror.aliyuncs.com"]
}
</span><span class="no">EOF
</span><span class="nb">sudo </span>systemctl daemon-reload
<span class="nb">sudo </span>systemctl restart docker

</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>curl <span class="nt">-L</span> https://github.com/docker/compose/releases/download/1.21.2/docker-compose-<span class="si">$(</span><span class="nb">uname</span> <span class="nt">-s</span><span class="si">)</span>-<span class="si">$(</span><span class="nb">uname</span> <span class="nt">-m</span><span class="si">)</span> <span class="nt">-o</span> /usr/local/bin/docker-compose
<span class="nb">sudo chmod</span> +x /usr/local/bin/docker-compose
docker-compose <span class="nt">--version</span>

</pre></td></tr></tbody></table></code></pre></div></div>
<p>å‚è€ƒ:</p>
<ol>
  <li>https://docs.docker.com/compose/install/#install-compose</li>
  <li></li>
</ol>

<h3 id="mac">mac</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>brew cask install docker
docker ps
docker-machine create default

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="å‘½ä»¤">å‘½ä»¤</h2>

<h3 id="run">run</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="rouge-code"><pre> docker run [OPTIONS] IMAGE [COMMAND] [ARG...]  
  -a, --attach=[]            ç™»å½•å®¹å™¨ï¼ˆä»¥docker run -då¯åŠ¨çš„å®¹å™¨ï¼‰  
  -c, --cpu-shares=0         è®¾ç½®å®¹å™¨CPUæƒé‡ï¼Œåœ¨CPUå…±äº«åœºæ™¯ä½¿ç”¨  
  --cap-add=[]               æ·»åŠ æƒé™ï¼Œæƒé™æ¸…å•è¯¦è§ï¼šhttp://linux.die.net/man/7/capabilities  
  --cap-drop=[]              åˆ é™¤æƒé™ï¼Œæƒé™æ¸…å•è¯¦è§ï¼šhttp://linux.die.net/man/7/capabilities  
  --cidfile=""               è¿è¡Œå®¹å™¨åï¼Œåœ¨æŒ‡å®šæ–‡ä»¶ä¸­å†™å…¥å®¹å™¨PIDå€¼ï¼Œä¸€ç§å…¸å‹çš„ç›‘æ§ç³»ç»Ÿç”¨æ³•  
  --cpuset=""                è®¾ç½®å®¹å™¨å¯ä»¥ä½¿ç”¨å“ªäº›CPUï¼Œæ­¤å‚æ•°å¯ä»¥ç”¨æ¥å®¹å™¨ç‹¬å CPU  
  -d, --detach=false         æŒ‡å®šå®¹å™¨è¿è¡Œäºå‰å°è¿˜æ˜¯åå°   
  --device=[]                æ·»åŠ ä¸»æœºè®¾å¤‡ç»™å®¹å™¨ï¼Œç›¸å½“äºè®¾å¤‡ç›´é€š  
  --dns=[]                   æŒ‡å®šå®¹å™¨çš„dnsæœåŠ¡å™¨  
  --dns-search=[]            æŒ‡å®šå®¹å™¨çš„dnsæœç´¢åŸŸåï¼Œå†™å…¥åˆ°å®¹å™¨çš„/etc/resolv.confæ–‡ä»¶  
  -e, --env=[]               æŒ‡å®šç¯å¢ƒå˜é‡ï¼Œå®¹å™¨ä¸­å¯ä»¥ä½¿ç”¨è¯¥ç¯å¢ƒå˜é‡  
  --entrypoint=""            è¦†ç›–imageçš„å…¥å£ç‚¹  
  --env-file=[]              æŒ‡å®šç¯å¢ƒå˜é‡æ–‡ä»¶ï¼Œæ–‡ä»¶æ ¼å¼ä¸ºæ¯è¡Œä¸€ä¸ªç¯å¢ƒå˜é‡  
  --expose=[]                æŒ‡å®šå®¹å™¨æš´éœ²çš„ç«¯å£ï¼Œå³ä¿®æ”¹é•œåƒçš„æš´éœ²ç«¯å£  
  -h, --hostname=""          æŒ‡å®šå®¹å™¨çš„ä¸»æœºå  
  -i, --interactive=false    æ‰“å¼€STDINï¼Œç”¨äºæ§åˆ¶å°äº¤äº’  
  --link=[]                  æŒ‡å®šå®¹å™¨é—´çš„å…³è”ï¼Œä½¿ç”¨å…¶ä»–å®¹å™¨çš„IPã€envç­‰ä¿¡æ¯  
  --lxc-conf=[]              æŒ‡å®šå®¹å™¨çš„é…ç½®æ–‡ä»¶ï¼Œåªæœ‰åœ¨æŒ‡å®š--exec-driver=lxcæ—¶ä½¿ç”¨  
  -m, --memory=""            æŒ‡å®šå®¹å™¨çš„å†…å­˜ä¸Šé™  
  --name=""                  æŒ‡å®šå®¹å™¨åå­—ï¼Œåç»­å¯ä»¥é€šè¿‡åå­—è¿›è¡Œå®¹å™¨ç®¡ç†ï¼Œlinksç‰¹æ€§éœ€è¦ä½¿ç”¨åå­—  
  --net="bridge"             å®¹å™¨ç½‘ç»œè®¾ç½®ï¼Œå¾…è¯¦è¿°  
  -P, --publish-all=false    æŒ‡å®šå®¹å™¨æš´éœ²çš„ç«¯å£ï¼Œå¾…è¯¦è¿°  
  -p, --publish=[]           æŒ‡å®šå®¹å™¨æš´éœ²çš„ç«¯å£ï¼Œå¾…è¯¦è¿°  
  --privileged=false         æŒ‡å®šå®¹å™¨æ˜¯å¦ä¸ºç‰¹æƒå®¹å™¨ï¼Œç‰¹æƒå®¹å™¨æ‹¥æœ‰æ‰€æœ‰çš„capabilities  
  --restart=""               æŒ‡å®šå®¹å™¨åœæ­¢åçš„é‡å¯ç­–ç•¥ï¼Œå¾…è¯¦è¿°  
  --rm=false                 æŒ‡å®šå®¹å™¨åœæ­¢åè‡ªåŠ¨åˆ é™¤å®¹å™¨(ä¸æ”¯æŒä»¥docker run -då¯åŠ¨çš„å®¹å™¨)  
  --sig-proxy=true           è®¾ç½®ç”±ä»£ç†æ¥å—å¹¶å¤„ç†ä¿¡å·ï¼Œä½†æ˜¯SIGCHLDã€SIGSTOPå’ŒSIGKILLä¸èƒ½è¢«ä»£ç†  
  -t, --tty=false            åˆ†é…ttyè®¾å¤‡ï¼Œè¯¥å¯ä»¥æ”¯æŒç»ˆç«¯ç™»å½•  
  -u, --user=""              æŒ‡å®šå®¹å™¨çš„ç”¨æˆ·  
  -v, --volume=[]            ç»™å®¹å™¨æŒ‚è½½å­˜å‚¨å·ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„æŸä¸ªç›®å½•  
  --volumes-from=[]          ç»™å®¹å™¨æŒ‚è½½å…¶ä»–å®¹å™¨ä¸Šçš„å·ï¼ŒæŒ‚è½½åˆ°å®¹å™¨çš„æŸä¸ªç›®å½•  
  -w, --workdir=""           æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•  


# å¯åŠ¨ä¸€ä¸ª bash ç»ˆç«¯ï¼Œå…è®¸ç”¨æˆ·è¿›è¡Œäº¤äº’
docker run -t -i ubuntu:14.04 /bin/bash

# å¯åŠ¨å·²ç»ˆæ­¢å®¹å™¨  
docker container start
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>â€“restartå‚æ•°ï¼Œæ”¯æŒä¸‰ç§é€»è¾‘å®ç°ï¼š
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>noï¼šå®¹å™¨é€€å‡ºæ—¶ä¸é‡å¯  
on-failureï¼šå®¹å™¨æ•…éšœé€€å‡ºï¼ˆè¿”å›å€¼éé›¶ï¼‰æ—¶é‡å¯  
alwaysï¼šå®¹å™¨é€€å‡ºæ—¶æ€»æ˜¯é‡å¯
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>ç½‘ç»œå‚æ•° â€“net</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nt">--net</span><span class="o">=</span>bridgeï¼š //ä½¿ç”¨docker daemonæŒ‡å®šçš„ç½‘æ¡¥
<span class="nt">--net</span><span class="o">=</span>hostï¼š //å®¹å™¨ä½¿ç”¨ä¸»æœºçš„ç½‘ç»œ
<span class="nt">--net</span><span class="o">=</span>container:NAME_or_IDï¼š//ä½¿ç”¨å…¶ä»–å®¹å™¨çš„ç½‘è·¯ï¼Œå…±äº«IPå’ŒPORTç­‰ç½‘ç»œèµ„æº
<span class="nt">--net</span><span class="o">=</span>noneï¼š //å®¹å™¨ä½¿ç”¨è‡ªå·±çš„ç½‘ç»œï¼ˆç±»ä¼¼--net<span class="o">=</span>bridgeï¼‰ï¼Œä½†æ˜¯ä¸è¿›è¡Œé…ç½®
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>æœ€ç®€å•çš„ä¾‹å­</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker run <span class="nt">--name</span> myredis <span class="nt">-d</span> redis
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="build">build</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker build -t runoob/ubuntu:v1 .
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="å†…ç½®ç›‘æ§">å†…ç½®ç›‘æ§</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c"># </span>
  docker stats <span class="si">$(</span>docker ps <span class="nt">--format</span><span class="o">={{</span>.Names<span class="o">}}</span><span class="si">)</span>
<span class="c">#   </span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å‚è€ƒ:
<a href="https://docs.docker.com/engine/reference/commandline/stats/">docker stats</a></p>

<h2 id="ä¸€äº›å‘ç‚¹">ä¸€äº›å‘ç‚¹</h2>

<h3 id="dockeræ˜¯æœ‰ç½‘ç»œç“¶é¢ˆçš„è¿™æ—¶å¯é€šè¿‡---nethostè§£å†³">dockeræ˜¯æœ‰ç½‘ç»œç“¶é¢ˆçš„,è¿™æ—¶å¯é€šè¿‡<code class="highlighter-rouge"> --net=host</code>è§£å†³.</h3>
<blockquote>
  <p>Docker æ”¯æŒçš„ç½‘ç»œæ¨¡å¼æœ‰ï¼š</p>

  <p>noneã€‚å…³é—­å®¹å™¨å†…çš„ç½‘ç»œè¿æ¥</p>

  <p>bridgeã€‚é€šè¿‡ veth æ¥å£æ¥è¿æ¥å®¹å™¨ï¼Œé»˜è®¤é…ç½®ã€‚</p>

  <p>hostã€‚å…è®¸å®¹å™¨ä½¿ç”¨ host çš„ç½‘ç»œå †æ ˆä¿¡æ¯ã€‚æ³¨æ„ï¼šè¿™ç§æ–¹å¼å°†å…è®¸å®¹å™¨è®¿é—® host ä¸­ç±»ä¼¼ D-BUS ä¹‹ç±»çš„ç³»ç»ŸæœåŠ¡ï¼Œæ‰€ä»¥è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ã€‚</p>

  <p>containerã€‚ä½¿ç”¨å¦å¤–ä¸€ä¸ªå®¹å™¨çš„ç½‘ç»œå †æ ˆä¿¡æ¯ã€‚ã€€</p>
  <ul>
    <li></li>
  </ul>
</blockquote>

<h3 id="cannot-connect-to-the-docker-daemon-on-macos">Cannot connect to the Docker daemon on macOS</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>brew cask install docker
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="å°‘ç”¨-add-æŒ‡ä»¤">å°‘ç”¨ ADD æŒ‡ä»¤</h3>

<p>ADDçš„å¦ä¸€ä¸ªåŠŸèƒ½æ˜¯èƒ½å¤Ÿè‡ªåŠ¨è§£å‹ç¼©å‹ç¼©æ–‡ä»¶ã€‚å¦‚æœå‚æ•°æ˜¯ä¸€ä¸ªè¯†åˆ«å‹ç¼©æ ¼å¼ï¼ˆtarï¼Œgzipï¼Œbzip2ç­‰ï¼‰çš„æœ¬åœ°æ–‡ä»¶ï¼Œé‚£ä¹ˆå®ƒå°†è¢«è§£å‹åˆ°å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„æŒ‡å®šå¤„ã€‚</p>

<p>å‚è€ƒé“¾æ¥ï¼š
<a href="https://juejin.im/post/5aa5d08e6fb9a028de4455d1">Dockerfile:ADD VS COPY</a></p>

<h3 id="entrypoint-æ‰§è¡Œçš„å®¹å™¨-æ¥æ”¶ä¸åˆ°-unix-ä¿¡å·">entrypoint æ‰§è¡Œçš„å®¹å™¨ æ¥æ”¶ä¸åˆ° <a href="https://zh.wikipedia.org/wiki/Unix%E4%BF%A1%E5%8F%B7">Unix ä¿¡å·</a></h3>

<p>entrypoint é€šè¿‡ sh -c æ‰§è¡Œï¼Œè¿™ä¼šå¯¼è‡´åº”ç”¨çš„pid!=1</p>

<h2 id="è¦ç‚¹">è¦ç‚¹:</h2>
<ul>
  <li>æ‰€æœ‰çš„æ–‡ä»¶å†™å…¥æ“ä½œï¼Œéƒ½åº”è¯¥ä½¿ç”¨ æ•°æ®å·ï¼ˆVolumeï¼‰ã€æˆ–è€…ç»‘å®šå®¿ä¸»ç›®å½•ï¼Œåœ¨è¿™äº›ä½ç½®çš„è¯»å†™ä¼šè·³è¿‡å®¹å™¨å­˜å‚¨å±‚ï¼Œç›´æ¥å¯¹å®¿ä¸»ï¼ˆæˆ–ç½‘ç»œå­˜å‚¨ï¼‰å‘ç”Ÿè¯»å†™ï¼Œå…¶æ€§èƒ½å’Œç¨³å®šæ€§æ›´é«˜ã€‚</li>
  <li>æ‰€ä»¥å¯¹äº CentOS/RHEL çš„ç”¨æˆ·æ¥è¯´ï¼Œåœ¨æ²¡æœ‰åŠæ³•ä½¿ç”¨ UnionFS çš„æƒ…å†µä¸‹ï¼Œä¸€å®šè¦é…ç½® direct-lvm ç»™ devicemapperï¼Œæ— è®ºæ˜¯ä¸ºäº†æ€§èƒ½ã€ç¨³å®šæ€§è¿˜æ˜¯ç©ºé—´åˆ©ç”¨ç‡ã€‚</li>
  <li>æ„å»ºé•œåƒçš„æ—¶å€™ç”¨<code class="highlighter-rouge">&amp;&amp;</code>è¿æ¥æŒ‡ä»¤,æœ€åéœ€è¦æ¸…ç†å¤šä½™çš„æ–‡ä»¶</li>
  <li>åº”è¯¥ä¼šå°† Dockerfile ç½®äºä¸€ä¸ªç©ºç›®å½•ä¸‹ï¼Œæˆ–è€…é¡¹ç›®æ ¹ç›®å½•ä¸‹</li>
  <li>ç›®å½•ä¸‹æœ‰äº›ä¸œè¥¿ç¡®å®ä¸å¸Œæœ›æ„å»ºæ—¶ä¼ ç»™ Docker å¼•æ“ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ .gitignore ä¸€æ ·çš„è¯­æ³•å†™ä¸€ä¸ª .dockerignore</li>
  <li></li>
</ul>

<ol>
  <li><a href="https://blog.phpgao.com/docker_alpine.html">ä½“éªŒAlpine Linux Docker Image</a></li>
</ol>

<h2 id="ä¸€äº›æŠ€å·§">ä¸€äº›æŠ€å·§</h2>

<h3 id="æŸ¥çœ‹é•œåƒtag">æŸ¥çœ‹é•œåƒtag</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>brew install httpie
http -a &lt;ç”¨æˆ·å&gt;:&lt;å¯†ç &gt; https://auth.docker.io/token  service==registry.docker.io scope==repository:library/nginx:pull
# æŠŠå‘½ä»¤ç»“æœçš„tokenæ›¿æ¢åˆ°$token
http https://registry.hub.docker.com/v2/library/nginx/tags/list 'Authorization: Bearer $token'

</pre></td></tr></tbody></table></code></pre></div></div>

<p>å‚è€ƒ</p>

<p><a href="https://yq.aliyun.com/articles/635236?spm=a2c4e.11155435.0.0.70446906jG4z8L">é€šè¿‡OAuthæ–¹å¼ä¸docker hub v2 APIäº¤äº’</a></p>

<h3 id="æŸ¥çœ‹google-containerçš„tag">æŸ¥çœ‹Google containerçš„tag</h3>

<p><a href="https://cloud.google.com/sdk/gcloud/reference/container/images/list-tags">å‘½ä»¤è¡Œæ–¹å¼</a></p>

<p><a href="https://gcr.io/v2/google-containers/pause/tags/list">æ¥å£æ–¹å¼</a></p>

<p><a href="https://console.cloud.google.com/gcr/images/google-containers/GLOBAL">ç½‘é¡µæ–¹å¼</a></p>

<h3 id="æŸ¥çœ‹å®¹å™¨å ç”¨çš„ä¸´æ—¶å­˜å‚¨">æŸ¥çœ‹å®¹å™¨å ç”¨çš„ä¸´æ—¶å­˜å‚¨</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>docker ps
docker inspect &lt;containerid&gt;
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ç»“æœæ˜¯ä¸€ä¸ªjson,<code class="highlighter-rouge">GraphDriver</code>å­—æ®µé‡Œé¢çš„å†…å®¹ä¾¿æ˜¯è¯¥å®¹å™¨è¯»å†™å±‚å ç”¨çš„ç©ºé—´</p>

<p><a href="https://docs.docker.com/storage/storagedriver/overlayfs-driver/#how-the-overlay2-driver-works">overlay2</a>è¿™ç§å­˜å‚¨é©±åŠ¨,å¤§æ¦‚é•¿è¿™æ ·</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>        "GraphDriver": {
            "Data": {
                "LowerDir": "/var/lib/docker/overlay2/a37aa91098cae96ea46461786e1fe5e737e6a9f6659aaecae03cb1a6649f2ec5-init/diff:/var/lib/docker/overlay2/bc8e51a75f0c75a4c99aee3365e61d819db62c40567d19065803f604c37b037c/diff:/var/lib/docker/overlay2/c6b772109941ef801751cc79df1fff5365d802313e62d891709fa5dc0a77e5ee/diff:/var/lib/docker/overlay2/57825e2f123ee01d2a0316633797eea092d456e86313e57f387f55984539fa12/diff:/var/lib/docker/overlay2/85a562eb1efa7fb47d73c1f3a872eff792e2897fb10acc7f5c3a36a949267ea8/diff:/var/lib/docker/overlay2/175ef167c94fabfcdd71c9c0c00cf84aff09092c525a23eb34ef1abdc5353315/diff:/var/lib/docker/overlay2/7f3e18afdbf72eef8cf3c3c85be17fd690bd8d08ab845351f13e2ab9373f7116/diff:/var/lib/docker/overlay2/6587c9c58d7fbeaa3b2d485033cea9ed16b5e58f5ffb1ab52cbf0ce5d10015db/diff:/var/lib/docker/overlay2/7a5a3316ee39f485f5834604b4ed2943864935601cb53d1ff4e61523236fd7e3/diff:/var/lib/docker/overlay2/e823c204b197123caf2cb190a4a7eb6b1664ef91610578cd3a9230edd9948711/diff:/var/lib/docker/overlay2/5ee74f69388ee558000e54fab92d7f245e38cbcb74d1d428e6e8acb1d84d5785/diff:/var/lib/docker/overlay2/a716238ee065c05799244c3bd375ecc3132f3039f4e041254a150b4900b43c84/diff:/var/lib/docker/overlay2/8cf97acec90c72c19d9efe245d7196a27903c2593d64c34d4fd68c0f3244afe3/diff:/var/lib/docker/overlay2/d31d19d7f6dae649f5318546dd374b7c332dbdab01bc61b7e47bafec0f1a33e9/diff",
                "MergedDir": "/var/lib/docker/overlay2/a37aa91098cae96ea46461786e1fe5e737e6a9f6659aaecae03cb1a6649f2ec5/merged",
                "UpperDir": "/var/lib/docker/overlay2/a37aa91098cae96ea46461786e1fe5e737e6a9f6659aaecae03cb1a6649f2ec5/diff",
                "WorkDir": "/var/lib/docker/overlay2/a37aa91098cae96ea46461786e1fe5e737e6a9f6659aaecae03cb1a6649f2ec5/work"
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å…³äºå­˜å‚¨é©±åŠ¨,<a href="http://dockone.io/article/1765">è¿™ç¯‡æ–‡ç« </a>è®²çš„è¿˜è¡Œ</p>

<h3 id="æ¸…ç†å®¹å™¨">æ¸…ç†å®¹å™¨</h3>

<p>æ¸…ç†å‰åä½¿ç”¨ä¸‹åˆ—å‘½ä»¤å¯å¯¹æ¯”æ•ˆæœ</p>

<p>docker system df -v</p>

<h4 id="æ–¹å¼1">æ–¹å¼1</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>    <span class="c"># å¦å¤–å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œæ¥åˆ é™¤æ‰€æœ‰å¤„äºåœæ­¢ï¼ˆExitedï¼‰çŠ¶æ€ä¸‹çš„å®¹å™¨ï¼š</span>
    docker <span class="nb">rm</span> <span class="nt">-v</span> <span class="si">$(</span>docker ps <span class="nt">-a</span> <span class="nt">-q</span> <span class="nt">-f</span> <span class="nv">status</span><span class="o">=</span>exited<span class="si">)</span>
    <span class="c">#è¦åˆ é™¤ï¼ˆæ‰€è°“çš„ï¼‰æ‚¬æŒ‚å·ï¼Œæ‚¨åº”è¯¥è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š</span>
    docker volume <span class="nb">rm</span> <span class="si">$(</span>docker volume <span class="nb">ls</span> <span class="nt">-qf</span> <span class="nv">dangling</span><span class="o">=</span><span class="nb">true</span><span class="si">)</span>
    <span class="c"># æœ€åï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ä»¥ç¡®ä¿å®Œæˆæ¸…ç†ä»»åŠ¡ï¼š</span>
    docker volume <span class="nb">ls</span> <span class="nt">-qf</span> <span class="nv">dangling</span><span class="o">=</span><span class="nb">true</span> | xargs <span class="nt">-r</span> docker volume <span class="nb">rm</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c">#! /bin/sh æ˜¯æŒ‡æ­¤è„šæœ¬ä½¿ç”¨/bin/shæ¥è§£é‡Šæ‰§è¡Œï¼Œ#!æ˜¯ç‰¹æ®Šçš„è¡¨ç¤ºç¬¦ï¼Œå…¶åé¢æ ¹çš„æ˜¯æ­¤è§£é‡Šæ­¤è„šæœ¬çš„shellçš„è·¯å¾„</span>
<span class="c">#!/bin/bash</span>
docker rmi <span class="nv">$ </span><span class="o">(</span>docker images <span class="nt">-q</span> <span class="nt">-f</span> <span class="nv">dangling</span><span class="o">=</span><span class="nb">true</span><span class="o">)</span>
docker volume <span class="nb">rm</span> <span class="si">$(</span>docker volume <span class="nb">ls</span> <span class="nt">-qf</span> <span class="nv">dangling</span><span class="o">=</span><span class="nb">true</span><span class="si">)</span>
0 0 1 ~/docker_clean.sh <span class="o">&gt;</span> /dev/null 2&gt;&amp;1
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nb">chmod </span>755 ~/docker_clean.sh
<span class="c"># å…¶ä¸­USERæ˜¯çœŸå®çš„ç”¨æˆ·å</span>
<span class="nb">sudo </span>usermod <span class="nt">-aG</span> docker USER
<span class="c"># æ³¨é”€åé‡æ–°ç™»å½• æˆ‘ä»¬é€šè¿‡è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»ºcronä½œä¸š</span>
crontab â€“e
<span class="c"># ä¿å­˜å¹¶å…³é—­crontabæ–‡ä»¶ã€‚ä¹‹ååœ¨æ¯ä¸ªåˆå¤œ12ç‚¹ï¼ŒDockerå°†è‡ªåŠ¨è¿›è¡Œæ¸…ç†ä»»åŠ¡ï¼Œå±Šæ—¶æ‚¨å°±å¯ä»¥ä½“éªŒä¸€ä¸ªå¹²å‡€ã€æ•´æ´çš„Dockeräº†ã€‚</span>

</pre></td></tr></tbody></table></code></pre></div></div>
<p>å‚è€ƒ:<a href="https://yq.aliyun.com/articles/279136?spm=a2c4e.11153959.0.0.16b9d55awTBOj5">4ä¸ªå®ç”¨å°æŠ€å·§ï¼Œæ¥ç»™ä½ çš„Docker è¿›è¡Œä¸€æ¬¡â€œå¤§æ‰«é™¤â€å§</a></p>

<h4 id="å¼ºçƒˆæ¨èæ–¹å¼2">ã€å¼ºçƒˆæ¨èã€‘æ–¹å¼2</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>docker system prune -a
docker system prune --volumes
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="oomæ’æŸ¥">OOMæ’æŸ¥</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nb">grep</span> <span class="nt">-i</span> OOM <span class="nt">-A</span> 5 <span class="nt">-B</span> 5 /var/log/messages
docker ps <span class="nt">-a</span> | <span class="nb">grep </span>5c223ed
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>Jul 30 08:11:33 izwz9hs52qcjvdljv2zxa2z kernel: Tasks state <span class="o">(</span>memory values <span class="k">in </span>pages<span class="o">)</span>:
Jul 30 08:11:33 izwz9hs52qcjvdljv2zxa2z kernel: <span class="o">[</span>  pid  <span class="o">]</span>   uid  tgid total_vm      rss pgtables_bytes swapents oom_score_adj name
Jul 30 08:11:33 izwz9hs52qcjvdljv2zxa2z kernel: <span class="o">[</span>  26934]     0 26934      411      128    40960        0           937 entrypoint.sh
Jul 30 08:11:33 izwz9hs52qcjvdljv2zxa2z kernel: <span class="o">[</span>  26981]     0 26981    48758     1814   118784        0           937 php-fpm7
Jul 30 08:11:33 izwz9hs52qcjvdljv2zxa2z kernel: <span class="o">[</span>  26982] 65534 26982    69086    25949   323584        0           937 php-fpm7
Jul 30 08:11:33 izwz9hs52qcjvdljv2zxa2z kernel: <span class="o">[</span>  26983] 65534 26983    70117    26791   331776        0           937 php-fpm7
Jul 30 08:11:33 izwz9hs52qcjvdljv2zxa2z kernel: <span class="o">[</span>  26986] 65534 26986    68812    25937   323584        0           937 php-fpm7
<span class="nt">--</span>
Jul 30 08:11:33 izwz9hs52qcjvdljv2zxa2z kernel: <span class="o">[</span>  23381] 65534 23381    51941     8278   184320        0           937 php-fpm7
Jul 30 08:11:33 izwz9hs52qcjvdljv2zxa2z kernel: <span class="o">[</span>  29842] 65534 29842    51729     8041   180224        0           937 php-fpm7
Jul 30 08:11:33 izwz9hs52qcjvdljv2zxa2z kernel: <span class="o">[</span>  29854] 65534 29854    50988     7278   176128        0           937 php-fpm7
Jul 30 08:11:33 izwz9hs52qcjvdljv2zxa2z kernel: <span class="o">[</span>  30426] 65534 30426    52385     8720   184320        0           937 php-fpm7
Jul 30 08:11:33 izwz9hs52qcjvdljv2zxa2z kernel: <span class="o">[</span>    317] 65534   317    51335     7618   176128        0           937 php-fpm7
Jul 30 08:11:33 izwz9hs52qcjvdljv2zxa2z kernel: oom-kill:constraint<span class="o">=</span>CONSTRAINT_NONE,nodemask<span class="o">=(</span>null<span class="o">)</span>,cpuset<span class="o">=</span>docker-5c223edfde3b17676cb982efdc201218a674578704d33d09de4775b721cb4702.scope,mems_allowed<span class="o">=</span>0,oom_memcg<span class="o">=</span>/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-podef7ce918_ae07_11e9_bf64_00163e08cd06.slice/docker-5c223edfde3b17676cb982efdc201218a674578704d33d09de4775b721cb4702.scope,task_memcg<span class="o">=</span>/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-podef7ce918_ae07_11e9_bf64_00163e08cd06.slice/docker-5c223edfde3b17676cb982efdc201218a674578704d33d09de4775b721cb4702.scope,task<span class="o">=</span>php-fpm7,pid<span class="o">=</span>26865,uid<span class="o">=</span>65534
Jul 30 08:11:33 izwz9hs52qcjvdljv2zxa2z kernel: Memory cgroup out of memory: Killed process 26865 <span class="o">(</span>php-fpm7<span class="o">)</span> total-vm:367860kB, anon-rss:177544kB, file-rss:1720kB, shmem-rss:13216kB
Jul 30 08:11:33 izwz9hs52qcjvdljv2zxa2z kernel: oom_reaper: reaped process 26865 <span class="o">(</span>php-fpm7<span class="o">)</span>, now anon-rss:0kB, file-rss:0kB, shmem-rss:13216kB
</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="highlighter-rouge">5c223edfde3b17676cb982efdc201218a674578704d33d09de4775b721cb4702</code> è¿™ä¸ªå°±æ˜¯å‡ºç°OOMçš„ container ID</p>

<h2 id="dockerfile-æŠ€å·§"><a href="https://mp.weixin.qq.com/s?__biz=MzI1OTY2MzMxOQ==&amp;mid=2247486135&amp;idx=2&amp;sn=0136343fedfb03d18ecd52f4b0297250&amp;chksm=ea743e0fdd03b719a4e31b0bf508d305c8ea95595fa6f94d1d149a1f39af950a97a08c21b831&amp;mpshare=1&amp;scene=23&amp;srcid=0722hfZqf9tVS6zNAMxua63c#rd">Dockerfile æŠ€å·§</a></h2>

<p>å˜åŠ¨çš„å±‚æ•°æ”¾æœ€å,å¯ç¼“å­˜çš„å±‚æ”¾å‰é¢</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>apt-get -y install -â€“no-install-recommends
rm -rf /var/lib/apt/lists/*
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="æ ¹æ®pidæŸ¥æ‰¾å®¹å™¨ä¿¡æ¯">æ ¹æ®PIDæŸ¥æ‰¾å®¹å™¨ä¿¡æ¯</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>
  docker ps <span class="nt">-q</span> | xargs docker inspect <span class="nt">--format</span> <span class="s1">'{{.State.Pid}}, {{.ID}}, {{.Name}}, {{.Config.Image}}'</span> | <span class="nb">grep</span> <span class="s2">"^</span><span class="k">${</span><span class="nv">PID</span><span class="k">}</span><span class="s2">,"</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>PS: docker inspect çš„å‘½ä»¤ç»“æœæ˜¯ä¸€ä¸ªjson,å¯ä»¥å…ˆä¸åŠ  format ,ç„¶åè‡ªå·±å®šä¹‰æ ¼å¼</p>

<p>å‚è€ƒé“¾æ¥:
<a href="https://stackoverflow.com/questions/24406743/coreos-get-docker-container-name-by-pid">CoreOS - get docker container name by PID?</a></p>

<h2 id="docker-ps--æ’åº">docker ps  æ’åº</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre>

docker ps <span class="nt">--format</span> <span class="s2">"table {{.ID}}</span><span class="se">\t</span><span class="s2">{{.Image}}"</span> | <span class="o">(</span><span class="nb">read</span> <span class="nt">-r</span><span class="p">;</span> <span class="nb">printf</span> <span class="s2">"%s</span><span class="se">\n</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$REPLY</span><span class="s2">"</span><span class="p">;</span> <span class="nb">sort</span> <span class="nt">-k</span> 2 <span class="o">)</span>

docker ps <span class="o">[</span><span class="nt">--format</span><span class="o">=</span><span class="s2">"TEMPLATE"</span><span class="o">]</span>

<span class="nt">--format</span><span class="o">=</span><span class="s2">"TEMPLATE"</span>
  Pretty-print containers using a Go template.
  Valid placeholders:
     .ID - Container ID
     .Image - Image ID
     .Command - Quoted <span class="nb">command</span>
     .CreatedAt - Time when the container was created.
     .RunningFor - Elapsed <span class="nb">time </span>since the container was started.
     .Ports - Exposed ports.
     .Status - Container status.
     .Size - Container disk size.
     .Names - Container names.
     .Labels - All labels assigned to the container.
     .Label - Value of a specific label <span class="k">for </span>this container. For example <span class="o">{{</span>.Label <span class="s2">"com.docker.swarm.cpu"</span><span class="o">}}</span>
     .Mounts - Names of the volumes mounted <span class="k">in </span>this container.


</pre></td></tr></tbody></table></code></pre></div></div>

<p><a href="https://stackoverflow.com/questions/46173298/how-to-sort-or-order-results-docker-ps-format">å‚è€ƒé“¾æ¥</a></p>

<h2 id="å­¦ä¸åŠ¨å•¦">å­¦ä¸åŠ¨å•¦</h2>

<p>å­¦ä¸åŠ¨ docker å‘½ä»¤æ²¡å…³ç³», <a href="https://github.com/jesseduffield/lazydocker">lazydocker</a> å¸®ä½ å¿™,å“ªé‡Œä¸ä¼šç‚¹å“ªé‡Œ,å¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘çš„ docker é—®é¢˜.</p>

<h2 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥:</h2>

<ol>
  <li><a href="https://kevinguo.me/2017/08/23/Docker-container-communication/">DockeråŸºç¡€-ç†è§£å®¹å™¨ä¹‹é—´çš„é€šä¿¡</a></li>
  <li><a href="https://blog.csdn.net/one_clouder/article/details/39224767">ã€dockerã€‘docker runå‘½ä»¤è¯¦è§£</a></li>
  <li><a href="https://blog.csdn.net/wsbgmofo/article/details/79173920">å¯åŠ¨dockerçš„æ—¶å€™æ€ä¹ˆæŠŠå‚æ•°ä¼ é€’ç»™dockeré‡Œé¢çš„é¡¹ç›®</a></li>
  <li><a href="http://wiki.jikexueyuan.com/project/openresty/web/docker.html">ä¸ Docker ä½¿ç”¨çš„ç½‘ç»œç“¶é¢ˆ</a></li>
  <li><a href="https://deepzz.com/post/docker-compose-file.html">å¦‚ä½•å†™docker-compose.ymlï¼ŒDocker compose file å‚è€ƒæ–‡æ¡£</a></li>
  <li><a href="http://dockone.io/article/128">æ·±å…¥ç†è§£Docker Volumeï¼ˆä¸€ï¼‰</a></li>
  <li><a href="https://docs.docker.com/storage/volumes/">Use volumes</a></li>
  <li><a href="https://itbilu.com/linux/docker/4kkTyS8Pf.html#docker-inspect">Docker å®¹å™¨(Container)çš„ç®¡ç†</a></li>
  <li><a href="https://docs.docker.com/compose/install/">Install Docker Compose</a></li>
</ol>
:ET
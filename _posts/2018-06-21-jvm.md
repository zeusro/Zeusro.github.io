---
layout:       post
title:        "Java JVM瞎搞"
subtitle:     ""
date:         2018-06-21
author:       "Zeusro"
header-img:   "img/oYYBAFHlDveICOlTAAWdBpjTP2sAAAvzgB9mBEABZ0e231.jpg"
header-mask:  0.3
catalog:      true
multilingual: false
tags:
    - Java
    - Jvm
---

## 常用的垃圾收集器

### ParNew 收集器

-XX:ParallelGCThreads
限制垃圾收集的线程数
 
### Parallel Scavenge收集器
 
最大垃圾收集停顿时间
-XX:MaxGCPauseMillis
吞吐量大小
-XX:GCTimeRatio
 
调低最大垃圾收集停顿时间以牺牲吞吐量和新生代空间作为代价,直接导致垃圾收集变得更加频繁
 
新手向操作:
-XX:UseAdaptiveSizePolicy
GC 自适应调节策略
 
### CMS 收集器

 以获取最短回收停顿时间为目标的收集器,基于"标记-清除"实现.
核心优点:并发手机,低停顿
 

* 阿里云监控的案例

```
/acs/user/monitoragent/jre/bin/java -server 
-Xmx128m 
-Xms128m 
-Xmn70m 
-XX:SurvivorRatio=10 
-XX:PermSize=25m 
-XX:MaxPermSize=30m 
-XX:+DisableExplicitGC 
-XX:+UseConcMarkSweepGC 
-XX:+CMSParallelRemarkEnabled 
-XX:+UseCMSCompactAtFullCollection 
-XX:+CMSClassUnloadingEnabled 
-XX:LargePageSizeInBytes=128m 
-XX:+UseFastAccessorMethods 
-XX:+UseCMSInitiatingOccupancyOnly 
-XX:CMSInitiatingOccupancyFraction=70 
-XX:+UseParNewGC 
-verbose:gc 
-Xloggc:/acs/monitor/system/monitoragent/logs/gc.log 
-XX:+PrintGCDetails 
-XX:+PrintGCDateStamps 
-Duser.timezone=GMT+8 
-Djava.endorsed.dirs= 
-classpath /acs/user/monitoragent/lib:/acs/user/monitoragent/lib/aliyun-openservices-sls-v0.3-inner-0.1.0.jar:/acs/user/monitoragent/lib/aliyun-openservices-with-mqs.1.0.12.jar:/acs/user/monitoragent/lib/commons-beanutils-1.8.3.jar:/acs/user/monitoragent/lib/commons-codec-1.4.jar:/acs/user/monitoragent/lib/commons-collections-3.2.1.jar:/acs/user/monitoragent/lib/commons-digester-1.8.jar:/acs/user/monitoragent/lib/commons-httpclient-3.1.jar:/acs/user/monitoragent/lib/commons-lang-2.6.jar:/acs/user/monitoragent/lib/commons-lang3-3.1.jar:/acs/user/monitoragent/lib/commons-logging-1.0.4.jar:/acs/user/monitoragent/lib/commons-validator-1.4.0.jar:/acs/user/monitoragent/lib/diamond-client-3.6.7.jar:/acs/user/monitoragent/lib/diamond-utils-3.1.3.jar:/acs/user/monitoragent/lib/ezmorph-1.0.6.jar:/acs/user/monitoragent/lib/fastjson-1.2.41.jar:/acs/user/monitoragent/lib/hamcrest-core-1.1.jar:/acs/user/monitoragent/lib/httpclient-4.2.1.jar:/acs/user/monitoragent/lib/httpcore-4.2.1.jar:/acs/user/monitoragent/lib/jackson-core-lgpl-1.9.6.jar:/acs/user/monitoragent/lib/jackson-mapper-lgpl-1.9.6.jar:/acs/user/monitoragent/lib/jdom-1.1.jar:/acs/user/monitoragent/lib/json-lib-2.4-jdk15.jar:/acs/user/monitoragent/lib/junit-4.10.jar:/acs/user/monitoragent/lib/log4j-1.2.17.jar:/acs/user/monitoragent/lib/mysql-connector-java-5.1.25.jar:/acs/user/monitoragent/lib/netty-all-4.0.36.Final.jar:/acs/user/monitoragent/lib/nginx.agent.jar:/acs/user/monitoragent/lib/ons-api-1.1.5.jar:/acs/user/monitoragent/lib/ons-client-1.1.5.jar:/acs/user/monitoragent/lib/protobuf-java-2.4.1.jar:/acs/user/monitoragent/lib/rocketmq-client-3.6.4.jar:/acs/user/monitoragent/lib/rocketmq-common-3.6.4.jar:/acs/user/monitoragent/lib/rocketmq-remoting-3.6.4.jar:/acs/user/monitoragent/lib/slf4j-api-1.7.5.jar:/acs/user/monitoragent/lib/slf4j-log4j12-1.7.5.jar:/acs/user/monitoragent/lib/test.junit-4.8.1.jar:/acs/user/monitoragent/lib/test.junit.hamcrest-1.1.jar: -Dagent.home=/acs/user/monitoragent com.alibaba.ace.nginx.agent.Startup /acs/user/monitoragent/conf
``` 

### G1收集器

### ConcMarkSweepGC

推荐使用的是-Xmn参数，原因是这个参数很简洁，相当于一次性设定NewSize和MaxNewSIze，而且两者相等。-Xmn配合-Xms堆起始大小和-Xmx堆最大大小，恰好把堆内存布局确定完了（估计设计者也是因为简洁的原因，弄出了三个简写参数）。另外，官文似乎说-Xmn是1.4才开始支持的，但是如今应该没有还在用1.4之前的JRE的吧。 

* 使用例子

```bash
java -jar 
-Xms10g 
-Xmx15g 
-XX:+UseConcMarkSweepGC 
-XX:NewSize=6g 
-XX:MaxNewSize=6g 
-verbose:gc 
-XX:+PrintGCDetails 
-XX:+PrintGCTimeStamps  
-Xloggc:./log/gc.log Slaver.jar
```

### G1







## jvm分析工具

### jstat
> jstat的好处是内置在jvm 中,使用简单粗暴

jstat -gc [pid] [间隔ms] [输出次数]

jstat -gc 5 3000 3000



参考链接:
1. [G1(Garbage First)的使用](http://bboniao.com/jvm/2014-03/g1garbage-first.html)



### MemoryAnalyzer




## 参考链接
1. [JVM调优：选择合适的GC collector （三）](https://blog.csdn.net/historyasamirror/article/details/6245157)
1. [深入理解 Java G1 垃圾收集器](http://ghoulich.xninja.org/tag/g1/)
1. [成为JavaGC专家（1）—深入浅出Java垃圾回收机制](http://www.importnew.com/1993.html)
1. [成为JavaGC专家（2）—如何监控Java垃圾回收机制](http://www.importnew.com/2057.html)
1. [成为Java GC专家（3）—如何优化Java垃圾回收机制](http://www.importnew.com/3146.html)
1. [成为Java GC专家（4）—Apache的MaxClients参数详解及其在Tomcat执行FullGC时的影响](http://www.importnew.com/3151.html)
1. [JVM系列三:JVM参数设置、分析](http://www.cnblogs.com/redcreen/archive/2011/05/04/2037057.html)
1. [介绍Java GC种类，并更换 调优GC](https://blog.csdn.net/roland101/article/details/2203461)
1. [Java 垃圾回收机制（以及怎么减少调用GC，提高性能）](https://blog.csdn.net/hyqsong/article/details/42006947)
1. [What Is Garbage Collection?](https://plumbr.io/handbook/what-is-garbage-collection)
1. [频繁GC (Allocation Failure)及young gc时间过长分析](https://juejin.im/post/5a9b811a6fb9a028e46e1c88)
1. []()
1. []()
1. []()
1. []()
---
layout:       post
title:        "多公有云CDN最佳实践"
subtitle:     ""
date:         2019-09-20
author:       "Zeusro"
header-img:   "img/oYYBAFHlDveICOlTAAWdBpjTP2sAAAvzgB9mBEABZ0e231.jpg"
header-mask:  0.3
catalog:      true
tags:
  - CDN
---

源站类型:
1. 纯静态(CDN流量多,回源流量小)
2. 纯动态(回源流量多)
2. 动静态(回源流量多,CDN流量多)

CDN供应商:
1. 阿里云
2. 网宿
3. cloudflare

加速区域:
1. 中国大陆
2. 海外
3. 全球

## 供应商介绍

### 阿里云 

阿里云是花样最多的,有普通CDN,PCDN,SCDN,全站加速(动态CDN),计费方式也五花八门,有按流量计费,按带宽计费,95增强计费等.

增强型95去峰带宽计费是一种只需预先支付少量保底带宽费用，即可享受多倍弹性峰值带宽，并在月底按多次去峰后的带宽峰值和实际使用时长收费的计费模式。目的保底带宽是40Mbps,比较适合40~100Mbps的网络使用.

有CDN免费证书.

阿里云比较不好的地方HTTPS请求计费,静态的便宜点,动态请求(回源请求)的要贵一些,而且加速区域还分国内国外.

但是与其他国内CDN比较,在于流量便宜(假设你一次性买200TB国内流量+20亿次请求数以上)

### 网宿

网宿是请求数不计费,但是价格较贵.有些产品还有平台使用费.产品迭代慢,UI开发落后.

有CDN免费证书.

不过好在可以后付费(其实阿里云大客户也可以,不过免息期只有1个月),可以按季度/年度后付费.默认加速区域有中国大陆（中国电信、中国铁通、中国联通、中国教育网、中国移动、其它、中国广电、长城宽带、E家宽）、欧洲/中东/非洲、美洲、亚太


### cloudflare

cloudflare 用得很少,它的特点是安全.用A解析的时候可以保护你源站IP不泄露,而且也会自动免费帮你申请SSL证书,这点很赞.

## 计费方式的选择

### 按流量计费

网站的流量有明显的峰谷特征,按流量计费会比较好

### 按带宽计费

花样是很多的,有95去峰带宽,平均带宽计费,第五带宽计费.

95去峰带宽适合每个月总有点大姨妈,但整体流量平稳

平均带宽计费适合每个月都中规中矩的网络

第五带宽计费适合每个月大姨妈型网络(每个月只有一两次网络出现高峰)

中国的带宽是很贵的,按带宽计费,建议划分2种场景:
1. 高带宽使用率(24小时都在用)
2. 低峰值带宽

## 结论

流量特征 | 方案
------- | ------- 
国内+纯静态+小带宽(<40Mbps) |网宿CDN+OSS+自建站点(记得用内网回源OSS)+EIP+增强型95计费共享带宽
国内+纯静态+大带宽| 阿里云CDN+OSS+OSS回源流量包
国内+动静态+小带宽(≈40Mbps)|网宿(利用他全球加速并且不计费请求数的特点)25Mpbs保底计费
国内+动静态+小带宽(≈40Mbps) |网宿CDN+阿里云ECS+增强型95计费共享带宽
国内+动静态+大带宽(>40Mbps)|DNS多线路分流(得额外付费). 小线路(联通电信其他)用网宿CDN+阿里云ECS+增强型95计费共享带宽,大线路用 阿里云CDN+阿里云ECS+流量计费CDN
国外+动静态+小流量|cloudflare免费版

方案不是绝对的,得自己衡量阿里云CDN+请求计费和其他平台的计费差异.

按照目前的价格来说,网宿在100Mbps内的动静态网站会比较有优势

阿里云胜在流量便宜

